!function(t){"use strict";const e=joinotify_builder_params,o={purchasedProducts:[],conditionType:"",isConditionAction:!1,getActionID:"",init:function(){null===o.getParamByName("id")&&t(".joinotify-loader-container").addClass("d-none"),this.workflowSteps(),this.triggerTabs(),this.loadWorkflowData(),this.onWorkflowReady(),this.fetchWorkflowTemplates(),this.uploadWorkflowTemplates()},onWorkflowReady:function(){t(document).on("workflowReady",(function(){o.addTrigger(),o.removeTrigger(),o.saveTriggerSettings(),o.sidebarActions(),o.addAction(),o.removeAction(),o.saveActionSettings(),o.codeEditor(),o.correctTriggerSettingsModal(),o.emojiPicker(),o.dismissPlaceholdersTip(),o.fetchAllGroups(),o.searchWooProducts(),o.changeWorkflowStatus(),o.updateWorkflowTitle(),o.initBootstrapComponents(),o.adjustHeightCondition(),o.changeVisibilityForElements(),o.initDatePicker(),o.whatsappMessagePreview(),o.exportWorkflow(),o.openMediaLibrary(),o.runTestWorkflow()}))},triggerTabs:function(){t(document).ready((function(){setTimeout((function(){t(".joinotify-triggers-tab-wrapper a.nav-tab").first().click()}),500)})),t(document).on("click",".joinotify-triggers-tab-wrapper a.nav-tab",(function(){let e=t(this).attr("href");t(".joinotify-triggers-tab-wrapper a.nav-tab").removeClass("nav-tab-active"),t(".triggers-content-wrapper .nav-content").removeClass("active"),t(this).addClass("nav-tab-active"),t(".triggers-content-wrapper").find(e).addClass("active")}))},keepButtonState:function(t){var e=t.width(),o=t.height(),i=t.html();return t.width(e),t.height(o),{width:e,height:o,html:i}},expandSidebar:function(){t(document).on("click",".expand-offcanvas",(function(e){e.preventDefault(),t(this).addClass("d-none"),t(this).siblings(".collapse-offcanvas").removeClass("d-none"),t(".offcanvas.show").addClass("offcanvas-expanded"),t("#joinotify_builder_funnel").addClass("offcanvas-expanded")})),t(document).on("click",'.btn-close[data-bs-dismiss="offcanvas"], .collapse-offcanvas',(function(){t(this).siblings(".expand-offcanvas").removeClass("d-none"),t(this).siblings(".collapse-offcanvas").addClass("d-none"),t(this).closest(".collapse-offcanvas").addClass("d-none"),t(".offcanvas.offcanvas-expanded").removeClass("offcanvas-expanded"),t("#joinotify_builder_funnel").removeClass("offcanvas-expanded")}))},closeSidebar:function(){t(document).on("click","#joinotify_close_actions_group",(function(e){e.preventDefault();let i=t("#joinotify_actions_group");i.removeClass("active"),t(".joinotify_condition_node_point").removeClass("active"),t(".plusminus.active").removeClass("active"),i.hasClass("active")?t("#joinotify_builder_funnel").addClass("waiting-select-action"):(t("#joinotify_builder_funnel").removeClass("waiting-select-action"),o.isConditionAction=!1,t(".action-item.locked").removeClass("locked"))}))},selectCondition:function(){t(document).on("click",".condition-item",(function(){var e=t(this).data("condition");t(".condition-item").removeClass("active"),t(".condition-settings-item").removeClass("active"),t(this).toggleClass("active"),t('.condition-settings-item[data-condition="'+e+'"]').addClass("active"),t(".condition-item").hasClass("active")?t("#add_action_condition").prop("disabled",!1):t("#add_action_condition").prop("disabled",!0)}))},resetActionSettings:function(){t(".set-time-delay-type option:first").attr("selected","selected"),t(".get-wait-value").val(""),t(".get-wait-period option:first").attr("selected","selected"),t(".get-date-value").val(""),t(".get-time-value").val(""),t("#joinotify_get_whatsapp_message_text").val("").change(),t("#joinotify_get_url_media").val(""),t(".condition-item.active").removeClass("active"),t(".condition-settings-item.active").removeClass("active"),t(".joinotify_condition_node_point").removeClass("active"),t(".get-condition-type").each((function(){t(this).find("option:first").attr("selected","selected")})),t(".get-condition-value").each((function(){t(this).find("option:first").attr("selected","selected")||t(this).val("")}))},uploadWorkflowTemplates:function(){t("#joinotify_import_file_zone").on("dragover dragleave",(function(e){e.preventDefault(),t(this).toggleClass("drag-over","dragover"===e.type)})),t("#joinotify_import_file_zone").on("drop",(function(e){e.preventDefault();var i=e.originalEvent.dataTransfer.files[0];t(this).hasClass("file-uploaded")||o.importWorkflow(i,t(this))})),t("#upload_template_file").on("change",(function(e){var i=e.target.files[0];o.importWorkflow(i,t(this).parents(".dropzone-license"))}))},importWorkflow:function(i,a){if(i){var n=i.name,s=new FormData;s.append("action","joinotify_import_workflow_templates"),s.append("security",e.import_nonce),s.append("file",i),n&&a.children(".file-list").removeClass("d-none").text(n),a.addClass("file-processing"),t("#joinotify_send_import_files").prop("disabled",!1),t("#joinotify_send_import_files").on("click",(function(i){i.preventDefault();var n=t(this),l=o.keepButtonState(n);t.ajax({url:e.ajax_url,type:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){e.debug_mode&&console.log(t);try{"success"===t.status?(a.addClass("file-uploaded").removeClass("file-processing"),a.children(".spinner-border").remove(),a.append('<div class="upload-notice d-flex flex-column align-items-center"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="#22c55e" d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path fill="#22c55e" d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg><span>'+t.dropfile_message+"</span></div>"),a.children(".file-list").addClass("d-none"),o.displayToast("success",t.toast_header_title,t.toast_body_title),setTimeout((function(){window.location.href=t.redirect}),1e3)):(a.addClass("invalid-file").removeClass("file-processing"),a.children(".drag-text").removeClass("d-none"),a.children(".drag-and-drop-file").removeClass("d-none"),a.children(".upload-license-key").removeClass("d-none"),a.children(".file-list").addClass("d-none"),o.displayToast("error",t.toast_header_title,t.toast_body_title))}catch(t){console.log(t)}},error:function(t,e,o){a.addClass("fail-upload").removeClass("file-processing"),console.log("Error on upload file"),console.log(t.responseText)},complete:function(){n.prop("disabled",!1).html(l.html)}})}))}else t("#joinotify_send_import_files").prop("disabled",!0)},sidebarActions:function(){o.openSidebar(),o.closeSidebar(),o.expandSidebar()},openSidebar:function(){const e=t("#joinotify_actions_group");t(document).on("click",".funnel_add_action",(function(){let i=t(this);o.conditionType=i.data("condition"),"condition"===i.data("action")?(e.hasClass("active")||(e.addClass("active"),t("#joinotify_builder_funnel").addClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").addClass("active")),o.isConditionAction=!0,o.getActionID=i.data("action-id"),t(".joinotify_condition_node_point").removeClass("active"),i.parent(".add_condition_inside_node_point").parent(".joinotify_condition_node_point").addClass("active"),t('.action-item[data-action="time_delay"]').addClass("locked"),t('.action-item[data-action="condition"]').addClass("locked")):(e.toggleClass("active"),o.isConditionAction=!1,o.getActionID="",t(".joinotify_condition_node_point").removeClass("active"),t('.action-item[data-action="time_delay"]').removeClass("locked"),t('.action-item[data-action="condition"]').removeClass("locked"),e.hasClass("active")?(t("#joinotify_builder_funnel").addClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").addClass("active")):(t("#joinotify_builder_funnel").removeClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").removeClass("active"),t(".joinotify_condition_node_point").removeClass("active"),o.isConditionAction=!1,t(".action-item.locked").removeClass("locked")))}))},displayToast:function(e,o,i){var a="",n="",s="";"success"===e?(a="toast-success",n="bg-success text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===e?(a="toast-danger",n="bg-danger text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):"warning"===e?(a="toast-warning",n="bg-warning text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(a="toast-secondary",n="bg-secondary text-white",s="");var l="toast-"+Math.random().toString(36).substr(2,9),r=`<div id="${l}" class="toast ${a} show">\n\t\t\t\t<div class="toast-header ${n}">\n\t\t\t\t\t\t${s}\n\t\t\t\t\t\t<span class="me-auto">${o}</span>\n\t\t\t\t\t\t<button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="Close"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="toast-body">${i}</div>\n\t\t\t</div>`;t("#joinotify-automations-builder").prepend(r),setTimeout((function(){jQuery("#"+l).fadeOut("fast")}),3e3),setTimeout((function(){jQuery("#"+l).remove()}),3500)},initBootstrapComponents:function(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((t=>new bootstrap.Tooltip(t)));t(document).on("click",'button[data-bs-toggle="modal"], a[data-bs-toggle="modal"]',(function(e){e.preventDefault();let o=t(this).attr("data-bs-target"),i=t(o).detach();t("#wpcontent").prepend(i)}))},fetchWorkflowTemplates:function(){o.getParamByName("id")||t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_templates_count",template:"template"},success:function(i){if(e.debug_mode&&console.log(i),"success"===i.status){var a=i.template_count,n=t(".joinotify-templates-group");n.empty();for(var s=0;s<a;s++)n.append('<div class="template-item placeholder-content"></div>');t("#joinotify_template_library_container").addClass("templates-counted")}else o.displayToast("error",i.toast_header_title,i.toast_body_title)},error:function(t,e,o){console.error("AJAX Error:",o)}})},getParamByName:function(t){let e=window.location.href;t=t.replace(/[\[\]]/g,"\\{text}");let o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},addQueryParam:function(t,e){var o=new URL(window.location.href);o.searchParams.set(t,e),window.history.pushState({},"",o)},correctTriggerSettingsModal:function(){t(".joinotify-trigger-details").each((function(){t(this).detach().insertAfter("#wpadminbar")})),null===o.getParamByName("id")&&t(".joinotify-loader-container").addClass("d-none")},adjustHeightCondition:function(){t(".funnel-trigger-group .funnel_block_item_condition").each((function(){var e=t(this),o=e.find(".add_condition_inside_node_point.condition_false"),i=e.find(".add_condition_inside_node_point.condition_true"),a=e.find(".end_condition_wrapper"),n=o.length>0?o.outerHeight(!0):0,s=i.length>0?i.outerHeight(!0):0,l=Math.max(n,s),r=`calc(1rem + ${l}px)`,d=`calc(${l}px - 100px)`;e.css("height",r),a.css("height",d)}))},addTrigger:function(){t("#joinotify_set_workflow_name").val(joinotify_builder_params.default_workflow_name);var i=t("#joinotify_set_workflow_name").val(),a=o.getParamByName("id");function n(){let e=t("#joinotify_set_workflow_name").val(),o=t(".trigger-item.active").data("trigger"),i=t("#joinotify_proceed_step_funnel");""!==e&&o?i.prop("disabled",!1):i.prop("disabled",!0)}t(document).on("change input","#joinotify_set_workflow_name",(function(){n()})),t(document).on("click",".trigger-item",(function(){t(".trigger-item").removeClass("active"),t(this).toggleClass("active"),n()})),t(document).on("click","#joinotify_proceed_step_funnel",(function(n){n.preventDefault();var s=t(this),l=o.keepButtonState(s);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_create_workflow",title:i,context:t(".trigger-item.active").data("context"),trigger:t(".trigger-item.active").data("trigger"),post_id:a},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){e.debug_mode&&console.log(n);try{"success"===n.status&&!0===n.proceed?(a?t("#joinotify_workflow_status").replaceWith(n.workflow_status):(o.addQueryParam("id",n.post_id),a=n.post_id,t("#joinotify_workflow_header_title_container").append(n.workflow_status)),t("#offcanvas_condition").find(".offcanvas-body").html(n.condition_selectors),t("#joinotify_actions_wrapper").html(n.sidebar_actions),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(n.fetch_groups_trigger),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(n.placeholders_list),t("#offcanvas_send_whatsapp_message_media").find(".offcanvas-body").append(n.fetch_groups_trigger),t("#send_whatsapp_message_media").find(".offcanvas-body").append(n.placeholders_list),t("#add_action_condition").prop("disabled",!0),t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active"),t("#joinotify_workflow_status_switch").prop("disabled",!1),t("#joinotify_workflow_title").text(i),document.title=i,t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(n.workflow_content),setTimeout((function(){if(n.active_settings_modal){let e=n.active_settings_modal,o=t(e).detach();t("#wpcontent").prepend(o),t(e).modal("show")}}),1e3),t(document).trigger("workflowReady"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(t){console.log(t)}},complete:function(){s.prop("disabled",!1).html(l.html)}})}))},removeTrigger:function(){t(document).on("click",".exclude-trigger",(function(i){if(i.preventDefault(),confirm(e.confirm_exclude_trigger)){var a=t(this);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_delete_trigger",post_id:o.getParamByName("id"),trigger_id:a.data("trigger-id")},beforeSend:function(){a.prop("disabled",!0),a.closest(".funnel-trigger-item").addClass("placeholder-wave removing-trigger")},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(i.has_trigger?t("#joinotify_builder_run_test").prop("disabled",!1):(t("#joinotify_triggers_group").addClass("active"),t("#joinotify_triggers_content").addClass("active"),t("#joinotify_builder_run_test").prop("disabled",!0),setTimeout((function(){t(".trigger-item").removeClass("active"),t(".joinotify-triggers-tab-wrapper a.nav-tab").first().click()}),500)),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("workflowReady"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1),a.closest(".funnel-trigger-item").removeClass("placeholder-wave removing-trigger")}})}}))},addAction:function(){t(document).on("click",".add-funnel-action",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=o.getParamByName("id"),l=a.data("action"),r={};const d=t(".offcanvas.show").find(".offcanvas-title").text();if("time_delay"===l){var c=t(".set-time-delay-type").val();r={type:"action",data:{action:"time_delay",title:d,delay_type:c}},"period"===c?(r.data.delay_value=t(".get-wait-value").val(),r.data.delay_period=t(".get-wait-period").val()):"date"===c&&(r.data.date_value=t(".get-date-value").val(),r.data.time_value=t(".get-time-value").val())}else if("send_whatsapp_message_text"===l)r={type:"action",data:{action:"send_whatsapp_message_text",title:d,sender:t("#joinotify_get_whatsapp_phone_sender").val(),receiver:t("#joinotify_get_whatsapp_number_msg_text").val(),message:t("#joinotify_get_whatsapp_message_text").val()}};else if("send_whatsapp_message_media"===l)r={type:"action",data:{action:"send_whatsapp_message_media",title:d,sender:t("#joinotify_get_whatsapp_phone_sender_media").val(),receiver:t("#joinotify_get_whatsapp_number_msg_media").val(),media_type:t("#joinotify_get_media_type").val(),media_url:t("#joinotify_get_url_media").val()}};else if("condition"===l){let e=t(".condition-item.active").data("condition");r={type:"action",data:{action:"condition",condition:e,title:t(".condition-item.active").find(".title").text(),condition_content:{condition:t(".condition-settings-item.active").data("condition"),type:t(".condition-settings-item.active").find(".get-condition-type option:selected").val(),type_text:t(".condition-settings-item.active").find(".get-condition-type option:selected").text(),value:t(".condition-settings-item.active").find(".get-condition-value option:selected").val()||t(".condition-settings-item.active").find(".get-condition-value").val(),value_text:t(".condition-settings-item.active").find(".get-condition-value option:selected").text()||t(".condition-settings-item.active").find(".get-condition-value").val()}}},"products_purchased"===e&&(r.data.condition_content.condition_content={products:o.purchasedProducts})}else"stop_funnel"===l?r={type:"action",data:{action:"stop_funnel"}}:"snippet_php"===l&&(r={type:"action",data:{action:"snippet_php",title:d,snippet_php:t(".offcanvas.show").find(".joinotify-code-editor").val()}});e.debug_mode&&(console.log(r),console.log("Post ID: ",s)),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_add_workflow_action",post_id:s,action_condition:o.isConditionAction,action_id:o.getActionID,condition_action:o.conditionType,workflow_action:JSON.stringify(r)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".offcanvas.show").removeClass("show"),o.resetActionSettings(),i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("workflowReady"),displayToast("success",i.toast_header_title,i.toast_body_title)):displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){o.adjustHeightCondition(),a.prop("disabled",!1).html(n.html),t("#joinotify_actions_group").removeClass("active"),t(".condition-item.active").removeClass("active"),t("#add_action_condition").prop("disabled",!0),t("#joinotify_builder_funnel").removeClass("waiting-select-action")}})})),o.selectCondition()},removeAction:function(){t(document).on("click",".exclude-action",(function(i){if(i.preventDefault(),confirm(e.confirm_exclude_action)){var a=t(this);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_delete_workflow_action",post_id:o.getParamByName("id"),action_id:a.data("action-id")},beforeSend:function(){a.prop("disabled",!0),a.closest(".funnel-action-item").addClass("placeholder-wave removing-action")},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("workflowReady"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1),a.closest(".funnel-action-item").removeClass("placeholder-wave removing-action"),o.adjustHeightCondition()}})}}))},changeWorkflowStatus:function(){t(document).on("click","#joinotify_workflow_status_switch",(function(){var i=t(this);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_update_workflow_status",status:i.prop("checked")?"publish":"draft",post_id:o.getParamByName("id")},beforeSend:function(){i.prop("disabled",!0)},complete:function(){i.prop("disabled",!1)},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_workflow_status_title").text(i.workflow_status),t("#joinotify_workflow_status").replaceWith(i.display_workflow_status),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}}})}))},loadWorkflowData:function(){var i=o.getParamByName("id");i&&t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_load_workflow_data",post_id:i},beforeSend:function(){t(".joinotify-loader-container").removeClass("d-none")},success:function(i){e.debug_mode&&console.log(i);try{if("success"===i.status){if(t("#joinotify_choose_template_container").removeClass("active"),t("#joinotify_builder_navbar").addClass("active"),i.has_trigger?(t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active")):(t("#joinotify_triggers_group").addClass("active"),t("#joinotify_triggers_content").addClass("active")),i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_actions_wrapper").html(i.sidebar_actions),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.placeholders_list),t("#offcanvas_send_whatsapp_message_media").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#send_whatsapp_message_media").find(".offcanvas-body").append(i.placeholders_list),t("#add_action_condition").prop("disabled",!0),t("#joinotify_workflow_title").text(i.workflow_title),t("#joinotify_edit_workflow_title").val(i.workflow_title),t("#joinotify_set_workflow_name").val(i.workflow_title),document.title=i.workflow_title,t("#joinotify_workflow_header_title_container").append(i.display_workflow_status),t("#joinotify_builder_funnel .funnel-trigger-group").prepend(i.workflow_data),t("#joinotify_workflow_status_switch").prop("disabled",!1),"publish"===i.workflow_status&&(t("#joinotify_workflow_status_switch").prop("checked",!0),t("#joinotify_workflow_status_title").text(e.status_active)),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t("#offcanvas_condition").find(".offcanvas-body").html(i.condition_selectors),i.active_settings_modal){let e=i.active_settings_modal,o=t(e).detach();t("#wpcontent").prepend(o),t(e).modal("show")}t(document).trigger("workflowReady"),t(".funnel-trigger-item").length>0&&t(".funnel-trigger-item").each((function(){var e=t(this).data("context"),o=t(this).data("trigger"),i=t('.trigger-item[data-context="'+e+'"][data-trigger="'+o+'"]');i.length>0&&i.addClass("active")}))}else o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){t(".joinotify-loader-container").addClass("d-none"),o.adjustHeightCondition()},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)}})},updateWorkflowTitle:function(){t(document).on("click","#joinotify_update_workflow_title",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_update_workflow_title",post_id:o.getParamByName("id"),workflow_title:t("#joinotify_edit_workflow_title").val()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_workflow_title").text(i.workflow_title),t("#joinotify_edit_workflow_title").val(i.workflow_title),t("#joinotify_set_workflow_name").val(i.workflow_title),document.title=i.workflow_title,t("#edit_workflow_title").find(".btn-close").click(),o.displayToast("success",i.toast_header_title,i.toast_body_title)):(t("#edit_workflow_title").find(".btn-close").click(),t("#joinotify_edit_workflow_title").val(""),o.displayToast("error",i.toast_header_title,i.toast_body_title))}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},changeVisibilityForElements:function(){t(document).on("change",".set-time-delay-type",(function(){var e=t(this),o=e.val();e.parent("div").siblings(".wait-time-period-container").toggleClass("d-none","period"!==o),e.parent("div").siblings(".wait-date-container").toggleClass("d-none","date"!==o)})),t(".set-time-delay-type").each((function(){var e=t(this),o=e.val();e.parent("div").siblings(".wait-time-period-container").toggleClass("d-none","period"!==o),e.parent("div").siblings(".wait-date-container").toggleClass("d-none","date"!==o)}))},initDatePicker:function(){t(".dateselect").datepicker({format:"dd/mm/yyyy",todayHighlight:!0,language:"pt-BR"}).on("changeDate",(function(){t(this).datepicker("hide")})),t(document).on("focus",".dateselect",(function(e){t(this).data("datepicker")||t(this).datepicker({format:"dd/mm/yyyy",todayHighlight:!0,language:"pt-BR"}),t(e.target).closest(".dateselect").length||t(".dateselect").datepicker("hide")}))},whatsappMessagePreview:function(){t(document).on("input change blur change",".set-whatsapp-message-text",(function(){var e=t(this).val(),o=t(this).parent("div").siblings(".preview-whatsapp-message-sender");""!==(e=(e=e.replace(/\n/g,"<br>")).replace(/{{ br }}/g,"<br>")).trim()?o.addClass("active").html(e):o.removeClass("active").html("")}))},downloadData:function(t,e,o){var i=new Blob([t],{type:o}),a=document.createElement("a"),n=URL.createObjectURL(i);a.href=n,a.download=e,document.body.appendChild(a),a.click(),setTimeout((function(){document.body.removeChild(a),window.URL.revokeObjectURL(n)}),0)},exportWorkflow:function(){t("#joinotify_export_workflow").on("click",(function(i){i.preventDefault();var a=o.getParamByName("id");t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_export_workflow",post_id:a,security:e.export_nonce},dataType:"json",beforeSend:function(){t(".joinotify-loader-container").removeClass("d-none").addClass("exporting-workflow")},complete:function(){t(".joinotify-loader-container").addClass("d-none").removeClass("exporting-workflow")},success:function(t){try{if("success"===t.status){var e="joinotify-workflow-"+a+".json";o.downloadData(JSON.stringify(t.export_data,null,2),e,"application/json"),o.displayToast("success",t.toast_header_title,t.toast_body_title)}else o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){alert("AJAX error: "+o)}})}))},workflowSteps:function(){t(document).on("click",".choose-template",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=a.data("template");a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>'),setTimeout((function(){a.prop("disabled",!1).html(n.html)}),1e3),"scratch"===s?setTimeout((function(){t("#joinotify_start_choose_container").removeClass("active"),t("#joinotify_choose_template_container").removeClass("active"),t("#joinotify_triggers_group").addClass("active"),t("#joinotify_triggers_content").addClass("active"),t("#joinotify_builder_navbar").addClass("active")}),1e3):"template"===s?(setTimeout((function(){t("#joinotify_start_choose_container").removeClass("active slide-left-animation").addClass("slide-right-animation"),t("#joinotify_template_library_container").addClass("active slide-left-animation").removeClass("slide-right-animation")}),1e3),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_workflow_templates",template:s},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".joinotify-templates-group").html(i.template_html),t("#joinotify_template_library_container").addClass("templates-loaded").removeClass("templates-counted")):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}}})):"import"===s&&setTimeout((function(){t("#joinotify_start_choose_container").removeClass("active slide-left-animation").addClass("slide-right-animation"),t("#joinotify_import_template_container").addClass("active slide-left-animation").removeClass("slide-right-animation")}),1e3)})),t(document).on("click",".return-to-start",(function(e){e.preventDefault(),t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active"),t("#joinotify_builder_navbar").removeClass("active"),t("#joinotify_choose_template_container").addClass("active"),t("#joinotify_start_choose_container").addClass("active")})),t(document).on("click","#joinotify_cancel_import_template",(function(e){e.preventDefault(),t("#joinotify_import_template_container").removeClass("active"),t("#joinotify_start_choose_container").addClass("active")}))},openMediaLibrary:function(){var o;t(document).on("click",".set-media-url",(function(i){i.preventDefault();var a=t(this);o||(o=wp.media.frames.file_frame=wp.media({title:e.set_media_title,button:{text:e.use_this_media_title},multiple:!1})).on("select",(function(){var t=o.state().get("selection").first().toJSON().url;a.siblings(".get-media-url").val(t).trigger("change")})),o.open()}))},runTestWorkflow:function(){t(document).on("click","#joinotify_builder_run_test",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_run_workflow_test",post_id:o.getParamByName("id")},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){e.debug_mode&&console.log(t);try{"success"===t.status?o.displayToast("success",t.toast_header_title,t.toast_body_title):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},dismissPlaceholdersTip:function(){t(document).on("click","#joinotify_dismiss_placeholders_tip",(function(o){o.preventDefault(),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_dismiss_placeholders_tip"},success:function(t){e.debug_mode&&console.log(t)},error:function(t){console.log(t)}})}))},fetchAllGroups:function(){t(document).on("click","#joinotify_fetch_all_groups",(function(i){i.preventDefault(),t("#joinotify_fetch_all_groups_container").hasClass("content-loaded")||t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_fetch_all_groups",sender:t("#joinotify_get_whatsapp_phone_sender").val()},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?t("#joinotify_fetch_all_groups_container").addClass("content-loaded").find(".modal-body").html(i.groups_details_html):(t("#joinotify_fetch_all_groups_container").find(".btn-close").click(),o.displayToast("error",i.toast_header_title,i.toast_body_title))}catch(t){console.log(t)}},error:function(t){console.log(t)}})})),t(document).on("click",".get-group-id",(function(){var o=t(this),i=o.data("group-id");navigator.clipboard.writeText(i).then((function(){o.append(`<div class="confirm-copy-ui active">\n\t\t\t\t\t\t\t\t<svg class="icon icon-lg icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path fill="#22c55e" d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>\n\t\t\t\t\t\t\t\t<span>${e.copy_group_id}</span>\n\t\t\t\t\t</div>`),setTimeout((function(){o.find(".confirm-copy-ui").removeClass("active")}),800),setTimeout((function(){o.find(".confirm-copy-ui").remove()}),1e3)})).catch((function(t){console.error("Error on copy group ID: "+t)}))}))},saveActionSettings:function(){t(document).on("click",".save-action-edit",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s={};if("time_delay"===get_action){var l=t(".modal.show").find(".set-time-delay-type-edit").val();s={action:"time_delay",data:{delay_type:l}},"period"===l?(s.data.delay_value=t(".modal.show").find(".get-wait-value").val(),s.data.delay_period=t(".modal.show").find(".get-wait-period").val()):"date"===l&&(s.data.date_value=t(".modal.show").find(".get-date-value").val(),s.data.time_value=t(".modal.show").find(".get-time-value").val())}else"send_whatsapp_message_text"===get_action?s={action:"send_whatsapp_message_text",data:{sender:t(".modal.show").find(".get-phone-sender-edit").val(),receiver:t(".modal.show").find(".get-whatsapp-number-edit").val(),message:t(".modal.show").find(".edit-whatsapp-message-text").val()}}:"send_whatsapp_message_media"===get_action?s={action:"send_whatsapp_message_media",data:{sender:t(".modal.show").find(".get-phone-sender-edit").val(),receiver:t(".modal.show").find(".get-whatsapp-number-edit").val(),media_type:t(".modal.show").find(".get-media-type-edit").val(),media_url:t(".modal.show").find(".get-media-url-edit").val()}}:"condition"===get_action?s={data:{action:"condition"}}:"snippet_php"===get_action?s={data:{action:"snippet_php",data:{snippet_php:t(".modal.show").find(".joinotify-code-editor").val()}}}:"create_coupon"===get_action&&(s={data:{action:"create_coupon",data:{}}});e.debug_mode&&console.log(s),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_save_action_edition",post_id:o.getParamByName("id"),action_id:o.getActionID,new_action_data:JSON.stringify(s)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(".modal.show").find(".btn-close").click(),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},codeEditor:function(){t(".joinotify-code-editor").each((function(){let e=this;if(!e.classList.contains("CodeMirror")){let o=CodeMirror.fromTextArea(e,{mode:"application/x-httpd-php",theme:"dracula",lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,indentUnit:4,tabSize:4});e.dataset.editor=o,""===o.getValue().trim()&&o.setValue("<?php\n\n"),o.on("change",(function(){e.value=o.getValue()})),setTimeout((function(){let o=t(e).next(".CodeMirror");if(o.length>0){let i=t('<div class="joinotify-resize-code-area"><svg class="icon-sm icon-dark opacity-75" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path></svg></div>');o.after(i);let a=!1,n=0,s=0;function l(t){if(!a)return;let e=t.clientY-n,i=s+e;i<100&&(i=100),o.css("height",i+"px"),o.find(".CodeMirror-scroll").css("height",i+"px")}function r(){a=!1,t(document).off("mousemove",l),t(document).off("mouseup",r)}i.on("mousedown",(function(e){e.preventDefault(),a=!0,n=e.clientY,s=o.outerHeight(),t(document).on("mousemove",l),t(document).on("mouseup",r)}))}else console.warn("CodeMirror element not found for textarea:",e)}),300)}}))},saveTriggerSettings:function(){t(document).on("click",".save-trigger-settings",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=a.data("trigger"),l=a.data("trigger-id"),r={};"woocommerce_order_status_changed"===s&&(r={order_status:t(".modal.show").find(".set-trigger-settings.order-status").val()}),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_save_trigger_settings",post_id:o.getParamByName("id"),trigger_id:l,settings:JSON.stringify(r)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".modal.show").find(".btn-close").click(),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},emojiPicker:function(){var o=e.emoji_picker_i18n;t(".add-emoji-picker").emojioneArea({tones:!0,hidePickerOnBlur:!0,recentEmojis:!0,pickerPosition:"bottom",searchPlaceholder:o.placeholder,buttonTitle:o.button_title,filters:{tones:{title:o.filters.tones_title},recent:{title:o.filters.recent_title},smileys_people:{title:o.filters.smileys_people_title},animals_nature:{title:o.filters.animals_nature_title},food_drink:{title:o.filters.food_drink_title},activity:{title:o.filters.activity_title},travel_places:{title:o.filters.travel_places_title},objects:{title:o.filters.objects_title},symbols:{title:o.filters.symbols_title},flags:{title:o.filters.flags_title}}})},searchWooProducts:function(){var i=!1;t(document).on("keyup",".search-products",(function(){let a=t(this),n=a.val().trim(),s=t(".search-products-results-wrapper");n.length>=3?(i||(i=!0,a.after('<i class="spinner-border specific-search-spinner"></i>')),t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_get_woo_products",search_query:n},success:function(e){t(".specific-search-spinner").remove(),i=!1,s.html(e.results_html),o.purchasedProducts.forEach((function(t){s.find('.list-group-item.product-item[data-product-id="'+t+'"]').addClass("active")}))},error:function(t,e,o){console.error("Error on search request:",o)}})):s.html("")})),t(document).on("click",".list-group-item.product-item",(function(){let e=t(this).data("product-id");t(this).toggleClass("active"),t(this).hasClass("active")?o.purchasedProducts.includes(e)||o.purchasedProducts.push(e):o.purchasedProducts=o.purchasedProducts.filter((t=>t!==e))}))}};jQuery(document).ready((function(t){o.init()}))}(jQuery);