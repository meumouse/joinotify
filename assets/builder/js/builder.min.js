!function(t){"use strict";const e=joinotify_builder_params,o={purchasedProducts:[],conditionType:"",isConditionAction:!1,getActionID:"",init:function(){null===o.getParamByName("id")&&t(".joinotify-loader-container").addClass("d-none"),this.addTrigger(),this.workflowSteps(),this.triggerTabs(),this.loadWorkflowData(),this.fetchWorkflowTemplates(),this.uploadWorkflowTemplates(),this.onWorkflowReady(),this.onUpdatedWorkflow()},onWorkflowReady:function(){t(document).on("workflowReady",(function(){o.saveTriggerSettings(),o.sidebarActions(),o.addAction(),o.removeAction(),o.saveActionSettings(),o.codeEditor(),o.codePreview(),o.correctTriggerSettingsModal(),o.emojiPicker(),o.dismissPlaceholdersTip(),o.fetchAllGroups(),o.searchWooProducts(),o.changeWorkflowStatus(),o.updateWorkflowTitle(),o.initBootstrapComponents(),o.adjustHeightCondition(),o.changeVisibilityForElements(),o.initDatePicker(),o.whatsappMessagePreview(),o.exportWorkflow(),o.openMediaLibrary(),o.runTestWorkflow(),o.validateInputCurrency()}))},onUpdatedWorkflow:function(){t(document).on("updatedWorkflow",(function(){o.changeVisibilityForElements(),o.codeEditor(),o.codePreview(),o.correctTriggerSettingsModal(),o.validateInputCurrency(),o.emojiPicker()}))},triggerTabs:function(){t(document).ready((function(){setTimeout((()=>{t(".joinotify-triggers-tab-wrapper a.nav-tab").first().click()}),500)})),t(document).on("click",".joinotify-triggers-tab-wrapper a.nav-tab",(function(){let e=t(this).attr("href");t(".joinotify-triggers-tab-wrapper a.nav-tab").removeClass("nav-tab-active"),t(".triggers-content-wrapper .nav-content").removeClass("active"),t(this).addClass("nav-tab-active"),t(".triggers-content-wrapper").find(e).addClass("active")}))},keepButtonState:function(t){var e=t.width(),o=t.height(),i=t.html();return t.width(e),t.height(o),{width:e,height:o,html:i}},expandSidebar:function(){t(document).on("click",".expand-offcanvas",(function(e){e.preventDefault(),t(this).addClass("d-none"),t(this).siblings(".collapse-offcanvas").removeClass("d-none"),t(".offcanvas.show").addClass("offcanvas-expanded"),t("#joinotify_builder_funnel").addClass("offcanvas-expanded")})),t(document).on("click",'.btn-close[data-bs-dismiss="offcanvas"], .collapse-offcanvas',(function(){t(this).siblings(".expand-offcanvas").removeClass("d-none"),t(this).siblings(".collapse-offcanvas").addClass("d-none"),t(this).closest(".collapse-offcanvas").addClass("d-none"),t(".offcanvas.offcanvas-expanded").removeClass("offcanvas-expanded"),t("#joinotify_builder_funnel").removeClass("offcanvas-expanded")}))},closeSidebar:function(){t(document).on("click","#joinotify_close_actions_group",(function(e){e.preventDefault();let i=t("#joinotify_actions_group");i.removeClass("active"),t(".joinotify_condition_node_point").removeClass("active"),t(".plusminus.active").removeClass("active"),i.hasClass("active")?t("#joinotify_builder_funnel").addClass("waiting-select-action"):(t("#joinotify_builder_funnel").removeClass("waiting-select-action"),o.isConditionAction=!1,t(".action-item.locked").removeClass("locked"))}))},selectCondition:function(){t(document).on("click",".condition-item",(function(){var e=t(this).data("condition");t(".condition-item").removeClass("active"),t(".condition-settings-item").removeClass("active"),t(this).toggleClass("active"),t('.condition-settings-item[data-condition="'+e+'"]').addClass("active"),t(".condition-item").hasClass("active")?t("#add_action_condition").prop("disabled",!1):t("#add_action_condition").prop("disabled",!0),t(".condition-settings-item .required-setting").removeClass("required-setting"),t('.condition-settings-item[data-condition="'+e+'"]').find("select, input, textarea").each((function(){"true"===t(this).attr("data-original-required")&&t(this).addClass("required-setting")})),o.enableAddActionButton()}))},resetActionSettings:function(){var e=t(".offcanvas");e.find(".set-time-delay-type option:first").attr("selected","selected"),e.find(".get-wait-value").val(""),e.find(".get-wait-period option:first").attr("selected","selected"),e.find(".get-date-value").val(""),e.find(".get-time-value").val(""),e.find(".get-whatsapp-receiver").val(""),e.find(".get-whatsapp-media-url").val(""),e.find(".condition-item.active").removeClass("active"),e.find(".condition-settings-item.active").removeClass("active"),e.find(".joinotify_condition_node_point").removeClass("active"),e.find(".get-condition-type").each((function(){t(this).find("option:first").attr("selected","selected")})),e.find(".get-condition-value").each((function(){t(this).find("option:first").attr("selected","selected")||t(this).val("")}));let o=t("#offcanvas_snippet_php").find(".joinotify-code-editor").next(".CodeMirror").get(0).CodeMirror;o&&o.setValue("<?php\n\n"),e.find(".generate-coupon-code").prop("checked",!1),e.find(".set-coupon-code").val(""),e.find(".set-coupon-description").val(""),e.find(".set-coupon-discount-type option:first").attr("selected","selected"),e.find(".set-coupon-discount-value").val(""),e.find(".allow-free-shipping").prop("checked",!1),e.find(".set-expires-coupon").prop("checked",!1)},uploadWorkflowTemplates:function(){t("#joinotify_import_file_zone").on("dragover dragleave",(function(e){e.preventDefault(),t(this).toggleClass("drag-over","dragover"===e.type)})),t("#joinotify_import_file_zone").on("drop",(function(e){e.preventDefault();var i=e.originalEvent.dataTransfer.files[0];t(this).hasClass("file-uploaded")||o.importWorkflow(i,t(this))})),t("#upload_template_file").on("change",(function(e){var i=e.target.files[0];o.importWorkflow(i,t(this).parents(".dropzone-license"))}))},importWorkflow:function(i,a){if(i){var n=i.name,s=new FormData;s.append("action","joinotify_import_workflow_templates"),s.append("security",e.import_nonce),s.append("file",i),n&&a.children(".file-list").removeClass("d-none").text(n),a.addClass("file-processing"),t("#joinotify_send_import_files").prop("disabled",!1),t("#joinotify_send_import_files").on("click",(function(i){i.preventDefault();var n=t(this),d=o.keepButtonState(n);t.ajax({url:e.ajax_url,type:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){e.debug_mode&&console.log(t);try{"success"===t.status?(a.addClass("file-uploaded").removeClass("file-processing"),a.children(".spinner-border").remove(),a.append('<div class="upload-notice d-flex flex-column align-items-center"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="#22c55e" d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path fill="#22c55e" d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg><span>'+t.dropfile_message+"</span></div>"),a.children(".file-list").addClass("d-none"),o.displayToast("success",t.toast_header_title,t.toast_body_title),setTimeout((()=>{window.location.href=t.redirect}),1e3)):(a.addClass("invalid-file").removeClass("file-processing"),a.children(".drag-text").removeClass("d-none"),a.children(".drag-and-drop-file").removeClass("d-none"),a.children(".upload-license-key").removeClass("d-none"),a.children(".file-list").addClass("d-none"),o.displayToast("error",t.toast_header_title,t.toast_body_title))}catch(t){console.log(t)}},error:function(t,e,o){a.addClass("fail-upload").removeClass("file-processing"),console.log("Error on upload file"),console.log(t.responseText)},complete:function(){n.prop("disabled",!1).html(d.html)}})}))}else t("#joinotify_send_import_files").prop("disabled",!0)},sidebarActions:function(){o.openSidebar(),o.closeSidebar(),o.expandSidebar()},openSidebar:function(){const e=t("#joinotify_actions_group");t(document).on("click",".funnel_add_action",(function(){let i=t(this);o.conditionType=i.data("condition"),"condition"===i.data("action")?(e.hasClass("active")||(e.addClass("active"),t("#joinotify_builder_funnel").addClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").addClass("active")),o.isConditionAction=!0,o.getActionID=i.data("action-id"),t(".joinotify_condition_node_point").removeClass("active"),i.parent(".add_condition_inside_node_point").parent(".joinotify_condition_node_point").addClass("active"),t('.action-item[data-action="time_delay"]').addClass("locked"),t('.action-item[data-action="condition"]').addClass("locked")):(e.toggleClass("active"),o.isConditionAction=!1,o.getActionID="",t(".joinotify_condition_node_point").removeClass("active"),t('.action-item[data-action="time_delay"]').removeClass("locked"),t('.action-item[data-action="condition"]').removeClass("locked"),e.hasClass("active")?(t("#joinotify_builder_funnel").addClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").addClass("active")):(t("#joinotify_builder_funnel").removeClass("waiting-select-action"),t(".funnel_add_action").children(".plusminus").removeClass("active"),t(".joinotify_condition_node_point").removeClass("active"),o.isConditionAction=!1,t(".action-item.locked").removeClass("locked")))}))},displayToast:function(e,o,i){var a="",n="",s="";"success"===e?(a="toast-success",n="bg-success text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===e?(a="toast-danger",n="bg-danger text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):"warning"===e?(a="toast-warning",n="bg-warning text-white",s='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(a="toast-secondary",n="bg-secondary text-white",s="");var d="toast-"+Math.random().toString(36).substr(2,9),r=`<div id="${d}" class="toast ${a} show">\n\t\t\t\t<div class="toast-header ${n}">\n\t\t\t\t\t\t${s}\n\t\t\t\t\t\t<span class="me-auto">${o}</span>\n\t\t\t\t\t\t<button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="Close"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="toast-body">${i}</div>\n\t\t\t</div>`;t("#joinotify-automations-builder").prepend(r),setTimeout((()=>{jQuery("#"+d).fadeOut("fast")}),3e3),setTimeout((()=>{jQuery("#"+d).remove()}),3500)},initBootstrapComponents:function(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((t=>new bootstrap.Tooltip(t)));t(document).on("click",'button[data-bs-toggle="modal"], a[data-bs-toggle="modal"]',(function(e){e.preventDefault();let o=t(this).attr("data-bs-target"),i=t(o).detach();t("#wpcontent").prepend(i)}))},fetchWorkflowTemplates:function(){o.getParamByName("id")||t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_templates_count",template:"template"},success:function(i){if(e.debug_mode&&console.log(i),"success"===i.status){var a=i.template_count,n=t(".joinotify-templates-group");n.empty();for(var s=0;s<a;s++)n.append('<div class="template-item placeholder-content"></div>');t("#joinotify_template_library_container").addClass("templates-counted")}else o.displayToast("error",i.toast_header_title,i.toast_body_title)},error:function(t,e,o){console.error("AJAX Error:",o)}})},getParamByName:function(t){let e=window.location.href;t=t.replace(/[\[\]]/g,"\\{text}");let o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},addQueryParam:function(t,e){var o=new URL(window.location.href);o.searchParams.set(t,e),window.history.pushState({},"",o)},correctTriggerSettingsModal:function(){t(".joinotify-trigger-details").each((function(){t(this).detach().insertAfter("#wpadminbar")}))},adjustHeightCondition:function(){t(".funnel-trigger-group .funnel_block_item_condition").each((function(){var e=t(this),o=e.find(".add_condition_inside_node_point.condition_false"),i=e.find(".add_condition_inside_node_point.condition_true"),a=e.find(".end_condition_wrapper"),n=o.length>0?o.outerHeight(!0):0,s=i.length>0?i.outerHeight(!0):0,d=Math.max(n,s),r=`calc(1rem + ${d}px)`,l=`calc(${d}px - 100px)`;e.css("height",r),a.css("height",l)}))},validateInputCurrency:function(){t(document).on("input",".format-currency",(function(){let e=t(this),o=e.val();o=o.replace(/[^0-9,]/g,"");let i=o.split(",");i.length>2&&(o=i[0]+","+i.slice(1).join("")),o=o.replace(/^0+(?=\d)/,"");let a=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,".")+(void 0!==i[1]?","+i[1]:"");e.val(a)})),t(document).on("keypress",".format-currency",(function(t){let e=String.fromCharCode(t.which);/[0-9,]/.test(e)||t.preventDefault()}))},enableAddTriggerButton:function(){function o(){let e=t("#joinotify_set_workflow_name").val(),o=t(".trigger-item.active").data("trigger"),i=t("#joinotify_proceed_step_funnel");""!==e&&o?i.prop("disabled",!1):i.prop("disabled",!0)}t("#joinotify_set_workflow_name").val(e.default_workflow_name),t(document).on("change input","#joinotify_set_workflow_name",(function(){t(this).val();o()})),t(document).on("click",".trigger-item",(function(){t(".trigger-item").removeClass("active"),t(this).toggleClass("active"),o()}))},addTrigger:function(){o.enableAddTriggerButton(),t(document).on("click","#joinotify_proceed_step_funnel",(function(i){i.preventDefault();var a=t("#joinotify_set_workflow_name").val(),n=o.getParamByName("id"),s=t(this),d=o.keepButtonState(s);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_create_workflow",title:a,context:t(".trigger-item.active").data("context"),trigger:t(".trigger-item.active").data("trigger"),post_id:n},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status&&!0===i.proceed?(n?t("#joinotify_workflow_status").replaceWith(i.workflow_status):(o.addQueryParam("id",i.post_id),n=i.post_id,t("#joinotify_workflow_header_title_container").append(i.workflow_status)),t("#joinotify_actions_wrapper").html(i.sidebar_actions),t("#offcanvas_condition").find(".offcanvas-body").html(i.condition_selectors),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.placeholders_list),t("#offcanvas_send_whatsapp_message_media").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#send_whatsapp_message_media").find(".offcanvas-body").append(i.placeholders_list),t("#add_action_condition").prop("disabled",!0),t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active"),t("#joinotify_workflow_status_switch").prop("disabled",!1),t("#joinotify_workflow_title").text(a),t("#joinotify_edit_workflow_title").val(a),document.title=a,t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),setTimeout((()=>{if(i.active_settings_modal){let e=i.active_settings_modal,o=t(e).detach();t("#wpcontent").prepend(o),t(e).modal("show")}}),1e3),t(document).trigger("workflowReady"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){s.prop("disabled",!1).html(d.html)}})}))},enableAddActionButton:function(){var e="";function o(){let o=!0;t(".offcanvas.show .required-setting").each((function(){const e=t(this);e.is("input")||e.is("textarea")?""===e.val().trim()&&(o=!1):e.is("select")&&"none"===e.val()&&(o=!1)})),o?t(e).prop("disabled",!1):t(e).prop("disabled",!0)}t(document).on("click",".action-item",(function(){setTimeout((()=>{e=t(".offcanvas.show").find(".add-funnel-action")}),500)})),t(".condition-settings-item .required-setting").each((function(){t(this).attr("data-original-required","true")})),t(document).on("change input blur keyup",".required-setting",(function(){o()})),t(document).on("click",".validate-required-settings, .condition-item",(function(){setTimeout((()=>{o()}),10)})),setTimeout((()=>{t("#add_action_stop_funnel").prop("disabled",!1)}),500)},getActionData:function(e,i){var a={},n=t(i);const s=n.find(".offcanvas-title, .modal-title").text();switch(e){case"time_delay":a={type:"action",data:{action:"time_delay",title:s,delay_type:d=n.find(".set-time-delay-type, .set-time-delay-type-edit").val()}},"period"===d?(a.data.delay_value=n.find(".get-wait-value").val(),a.data.delay_period=n.find(".get-wait-period").val()):"date"===d&&(a.data.date_value=n.find(".get-date-value").val(),a.data.time_value=n.find(".get-time-value").val());break;case"send_whatsapp_message_text":a={type:"action",data:{action:"send_whatsapp_message_text",title:s,sender:n.find(".get-whatsapp-phone-sender").val(),receiver:n.find(".get-whatsapp-receiver").val(),message:n.find(".set-whatsapp-message-text").val()}};break;case"send_whatsapp_message_media":a={type:"action",data:{action:"send_whatsapp_message_media",title:s,sender:n.find(".get-whatsapp-phone-sender").val(),receiver:n.find(".get-whatsapp-receiver").val(),media_type:n.find(".get-whatsapp-media-type").val(),media_url:n.find(".get-whatsapp-media-url").val()}};break;case"condition":let t=n.find(".condition-item.active").data("condition");a={type:"action",data:{action:"condition",condition:t,title:n.find(".condition-item.active .title").text(),condition_content:{condition:n.find(".condition-settings-item.active").data("condition"),type:n.find(".condition-settings-item.active .get-condition-type option:selected").val(),type_text:n.find(".condition-settings-item.active .get-condition-type option:selected").text(),value:n.find(".condition-settings-item.active .get-condition-value option:selected").val()||n.find(".condition-settings-item.active .get-condition-value").val(),value_text:n.find(".condition-settings-item.active .get-condition-value option:selected").text()||n.find(".condition-settings-item.active .get-condition-value").val()}}},"products_purchased"===t&&(a.data.condition_content.condition_content={products:o.purchasedProducts});break;case"stop_funnel":a={type:"action",data:{action:"stop_funnel"}};break;case"snippet_php":a={type:"action",data:{action:"snippet_php",title:s,snippet_php:n.find(".joinotify-code-editor").val()}};break;case"create_coupon":var d=n.find(".set-time-delay-type").val();a={type:"action",data:{action:"create_coupon",title:s,settings:{generate_coupon:n.find(".generate-coupon-code").prop("checked")?"yes":"no",coupon_code:n.find(".set-coupon-code").val()||"",coupon_description:n.find(".set-coupon-description").val(),discount_type:n.find(".set-coupon-discount-type").val(),coupon_amount:n.find(".set-coupon-discount-value").val(),free_shipping:n.find(".allow-free-shipping").prop("checked")?"yes":"no",coupon_expiry:n.find(".set-expires-coupon").prop("checked")?"yes":"no",expiry_data:{type:d||""},message:{sender:n.find(".get-whatsapp-phone-sender").val(),receiver:n.find(".get-whatsapp-receiver").val(),message:n.find(".set-whatsapp-message-text").val()}}}},"period"===d?(a.data.settings.expiry_data.delay_value=n.find(".get-wait-value").val(),a.data.settings.expiry_data.delay_period=n.find(".get-wait-period").val()):"date"===d&&(a.data.settings.expiry_data.date_value=n.find(".get-date-value").val(),a.data.settings.expiry_data.time_value=n.find(".get-time-value").val())}return a},addAction:function(){o.selectCondition(),o.enableAddActionButton(),t(document).on("click",".add-funnel-action",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=o.getParamByName("id"),d=a.data("action"),r=o.getActionData(d,".offcanvas.show");e.debug_mode&&(console.log(r),console.log("Post ID: ",s)),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_add_workflow_action",post_id:s,action_condition:o.isConditionAction,action_id:o.getActionID,condition_action:o.conditionType,workflow_action:JSON.stringify(r)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".offcanvas.show").removeClass("show"),a.prop("disabled",!0),o.resetActionSettings(),i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("updatedWorkflow"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){o.adjustHeightCondition(),a.html(n.html),t("#joinotify_actions_group").removeClass("active"),t(".condition-item.active").removeClass("active"),t("#add_action_condition").prop("disabled",!0),t("#joinotify_builder_funnel").removeClass("waiting-select-action")}})}))},removeAction:function(){t(document).on("click",".exclude-action",(function(i){if(i.preventDefault(),confirm(e.confirm_exclude_action)){var a=t(this);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_delete_workflow_action",post_id:o.getParamByName("id"),action_id:a.data("action-id")},beforeSend:function(){a.prop("disabled",!0),a.closest(".funnel-action-item").addClass("placeholder-wave removing-action")},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("updatedWorkflow"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1),a.closest(".funnel-action-item").removeClass("placeholder-wave removing-action"),o.adjustHeightCondition()}})}}))},changeWorkflowStatus:function(){t(document).on("click","#joinotify_workflow_status_switch",(function(){var i=t(this);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_update_workflow_status",status:i.prop("checked")?"publish":"draft",post_id:o.getParamByName("id")},beforeSend:function(){i.prop("disabled",!0)},complete:function(){i.prop("disabled",!1)},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_workflow_status_title").text(i.workflow_status),t("#joinotify_workflow_status").replaceWith(i.display_workflow_status),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}}})}))},loadWorkflowData:function(){var i=o.getParamByName("id");i&&t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_load_workflow_data",post_id:i},beforeSend:function(){t(".joinotify-loader-container").removeClass("d-none")},success:function(i){e.debug_mode&&console.log(i);try{if("success"===i.status){if(t("#joinotify_choose_template_container").removeClass("active"),t("#joinotify_builder_navbar").addClass("active"),i.has_trigger?(t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active")):(t("#joinotify_triggers_group").addClass("active"),t("#joinotify_triggers_content").addClass("active")),i.has_action?t("#joinotify_builder_run_test").prop("disabled",!1):t("#joinotify_builder_run_test").prop("disabled",!0),t("#joinotify_actions_wrapper").html(i.sidebar_actions),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#offcanvas_send_whatsapp_message_text").find(".offcanvas-body").append(i.placeholders_list),t("#offcanvas_send_whatsapp_message_media").find(".offcanvas-body").append(i.fetch_groups_trigger),t("#send_whatsapp_message_media").find(".offcanvas-body").append(i.placeholders_list),t("#add_action_condition").prop("disabled",!0),t("#joinotify_workflow_title").text(i.workflow_title),t("#joinotify_edit_workflow_title").val(i.workflow_title),t("#joinotify_set_workflow_name").val(i.workflow_title),document.title=i.workflow_title,t("#joinotify_workflow_header_title_container").append(i.display_workflow_status),t("#joinotify_builder_funnel .funnel-trigger-group").prepend(i.workflow_data),t("#joinotify_workflow_status_switch").prop("disabled",!1),"publish"===i.workflow_status&&(t("#joinotify_workflow_status_switch").prop("checked",!0),t("#joinotify_workflow_status_title").text(e.status_active)),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t("#offcanvas_condition").find(".offcanvas-body").html(i.condition_selectors),i.active_settings_modal){let e=i.active_settings_modal,o=t(e).detach();t("#wpcontent").prepend(o),t(e).modal("show")}t(document).trigger("workflowReady"),t(".funnel-trigger-item").length>0&&t(".funnel-trigger-item").each((function(){var e=t(this).data("context"),o=t(this).data("trigger"),i=t('.trigger-item[data-context="'+e+'"][data-trigger="'+o+'"]');i.length>0&&i.addClass("active")}))}else o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){t(".joinotify-loader-container").addClass("d-none"),o.adjustHeightCondition()},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)}})},updateWorkflowTitle:function(){t(document).on("click","#joinotify_update_workflow_title",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_update_workflow_title",post_id:o.getParamByName("id"),workflow_title:t("#joinotify_edit_workflow_title").val()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_workflow_title").text(i.workflow_title),t("#joinotify_edit_workflow_title").val(i.workflow_title),t("#joinotify_set_workflow_name").val(i.workflow_title),document.title=i.workflow_title,t("#edit_workflow_title").find(".btn-close").click(),o.displayToast("success",i.toast_header_title,i.toast_body_title)):(t("#edit_workflow_title").find(".btn-close").click(),t("#joinotify_edit_workflow_title").val(""),o.displayToast("error",i.toast_header_title,i.toast_body_title))}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},changeVisibilityForTimeDelay:function(){t(document).on("change",".set-time-delay-type",(function(){var e=t(this),o=e.val();e.parent("div").siblings(".wait-time-period-container").toggleClass("d-none","period"!==o),e.parent("div").siblings(".wait-time-period-container").find(".get-wait-value").toggleClass("required-setting","period"===o),e.parent("div").siblings(".wait-date-container").toggleClass("d-none","date"!==o),e.parent("div").siblings(".wait-date-container").find(".get-date-value").toggleClass("required-setting","date"===o)})),setTimeout((()=>{t(".set-time-delay-type").each((function(){var e=t(this),o=e.val();e.parent("div").siblings(".wait-time-period-container").toggleClass("d-none","period"!==o),e.parent("div").siblings(".wait-time-period-container").find(".get-wait-value").toggleClass("required-setting","period"===o),e.parent("div").siblings(".wait-date-container").toggleClass("d-none","date"!==o),e.parent("div").siblings(".wait-date-container").find(".get-date-value").toggleClass("required-setting","date"===o)}))}),500)},changeVisibilityForCouponCode:function(){function e(t){var e=t.prop("checked");t.parent("div").siblings(".coupon-code-wrapper").toggleClass("d-none",e).find(".set-coupon-code").toggleClass("required-setting",!e)}function o(t){var e=t.prop("checked"),o=t.parent("div").siblings(".select-time-delay-container").find(".set-time-delay-type");t.parent("div").siblings(".select-time-delay-container").toggleClass("d-none",!e),"period"===o.val()?t.parent("div").siblings(".wait-time-period-container").toggleClass("d-none",!e).find(".get-wait-value").toggleClass("required-setting",e):"date"===o.val()&&t.parent("div").siblings(".wait-date-container").toggleClass("d-none",!e).find(".get-date-value").toggleClass("required-setting",e)}t(document).on("change",".generate-coupon-code",(function(){e(t(this))})),t(document).on("change",".set-expires-coupon",(function(){o(t(this))})),setTimeout((()=>{t("#offcanvas_create_coupon").find(".wait-time-period-container").addClass("d-none"),t("#offcanvas_create_coupon").find(".get-wait-value").removeClass("required-setting"),t(".generate-coupon-code").each((function(){e(t(this))})),t(".set-expires-coupon").each((function(){o(t(this))}))}),600)},changeVisibilityForElements:function(){o.changeVisibilityForTimeDelay(),o.changeVisibilityForCouponCode()},initDatePicker:function(){t(".dateselect").datepicker({format:"dd/mm/yyyy",todayHighlight:!0,language:"pt-BR"}).on("changeDate",(function(){t(this).datepicker("hide")})),t(document).on("focus",".dateselect",(function(e){t(this).data("datepicker")||t(this).datepicker({format:"dd/mm/yyyy",todayHighlight:!0,language:"pt-BR"}),t(e.target).closest(".dateselect").length||t(".dateselect").datepicker("hide")}))},whatsappMessagePreview:function(){t(document).on("input change blur change keyup",".set-whatsapp-message-text",(function(){var e=t(this).val(),o=t(this).parent("div").siblings(".preview-whatsapp-message-sender");""!==(e=(e=e.replace(/\n/g,"<br>")).replace(/{{ br }}/g,"<br>")).trim()?o.addClass("active").html(e):o.removeClass("active").html("")}))},downloadData:function(t,e,o){var i=new Blob([t],{type:o}),a=document.createElement("a"),n=URL.createObjectURL(i);a.href=n,a.download=e,document.body.appendChild(a),a.click(),setTimeout((()=>{document.body.removeChild(a),window.URL.revokeObjectURL(n)}),0)},exportWorkflow:function(){t("#joinotify_export_workflow").on("click",(function(i){i.preventDefault();var a=o.getParamByName("id");t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_export_workflow",post_id:a,security:e.export_nonce},dataType:"json",beforeSend:function(){t(".joinotify-loader-container").removeClass("d-none").addClass("exporting-workflow")},complete:function(){t(".joinotify-loader-container").addClass("d-none").removeClass("exporting-workflow")},success:function(t){try{if("success"===t.status){var e="joinotify-workflow-"+a+".json";o.downloadData(JSON.stringify(t.export_data,null,2),e,"application/json"),o.displayToast("success",t.toast_header_title,t.toast_body_title)}else o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){alert("AJAX error: "+o)}})}))},workflowSteps:function(){t(document).on("click",".choose-template",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=a.data("template");a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>'),setTimeout((()=>{a.prop("disabled",!1).html(n.html)}),1e3),"scratch"===s?setTimeout((()=>{t("#joinotify_start_choose_container").removeClass("active"),t("#joinotify_choose_template_container").removeClass("active"),t("#joinotify_triggers_group").addClass("active"),t("#joinotify_triggers_content").addClass("active"),t("#joinotify_builder_navbar").addClass("active")}),1e3):"template"===s?(setTimeout((()=>{t("#joinotify_start_choose_container").removeClass("active slide-left-animation").addClass("slide-right-animation"),t("#joinotify_template_library_container").addClass("active slide-left-animation").removeClass("slide-right-animation")}),1e3),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_workflow_templates",template:s},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".joinotify-templates-group").html(i.template_html),t("#joinotify_template_library_container").addClass("templates-loaded").removeClass("templates-counted")):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}}})):"import"===s&&setTimeout((()=>{t("#joinotify_start_choose_container").removeClass("active slide-left-animation").addClass("slide-right-animation"),t("#joinotify_import_template_container").addClass("active slide-left-animation").removeClass("slide-right-animation")}),1e3)})),t(document).on("click",".return-to-start",(function(e){e.preventDefault(),t("#joinotify_triggers_group").removeClass("active"),t("#joinotify_triggers_content").removeClass("active"),t("#joinotify_builder_navbar").removeClass("active"),t("#joinotify_choose_template_container").addClass("active"),t("#joinotify_start_choose_container").addClass("active")})),t(document).on("click","#joinotify_cancel_import_template",(function(e){e.preventDefault(),t("#joinotify_import_template_container").removeClass("active"),t("#joinotify_start_choose_container").addClass("active")}))},openMediaLibrary:function(){var o;t(document).on("click",".set-media-url",(function(i){i.preventDefault();var a=t(this);o||(o=wp.media.frames.file_frame=wp.media({title:e.set_media_title,button:{text:e.use_this_media_title},multiple:!1})).on("select",(function(){var t=o.state().get("selection").first().toJSON().url;a.siblings(".get-media-url").val(t).trigger("change")})),o.open()}))},runTestWorkflow:function(){t(document).on("click","#joinotify_builder_run_test",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_run_workflow_test",post_id:o.getParamByName("id")},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){e.debug_mode&&console.log(t);try{"success"===t.status?o.displayToast("success",t.toast_header_title,t.toast_body_title):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},dismissPlaceholdersTip:function(){t(document).on("click","#joinotify_dismiss_placeholders_tip",(function(o){o.preventDefault(),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_dismiss_placeholders_tip"},success:function(t){e.debug_mode&&console.log(t)},error:function(t){console.log(t)}})}))},fetchAllGroups:function(){t(document).on("click","#joinotify_fetch_all_groups",(function(i){i.preventDefault(),t("#joinotify_fetch_all_groups_container").hasClass("content-loaded")||t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_fetch_all_groups",sender:t(".offcanvas.show").find(".get-whatsapp-phone-sender").val()},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?t("#joinotify_fetch_all_groups_container").addClass("content-loaded").find(".modal-body").html(i.groups_details_html):(t("#joinotify_fetch_all_groups_container").find(".btn-close").click(),o.displayToast("error",i.toast_header_title,i.toast_body_title))}catch(t){console.log(t)}},error:function(t){console.log(t)}})})),t(document).on("click",".get-group-id",(function(){var o=t(this),i=o.data("group-id");navigator.clipboard.writeText(i).then((function(){o.append(`<div class="confirm-copy-ui active">\n\t\t\t\t\t\t<svg class="icon icon-lg icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>\n\t\t\t\t\t\t<span>${e.copy_group_id}</span>\n\t\t\t\t\t</div>`),setTimeout((()=>{o.find(".confirm-copy-ui").removeClass("active")}),800),setTimeout((()=>{o.find(".confirm-copy-ui").remove()}),1e3)})).catch((function(t){console.error("Error on copy group ID: "+t)}))}))},saveActionSettings:function(){t(document).on("click",".save-action-edit",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=a.data("action"),d=a.data("action-id"),r=o.getActionData(s,".modal.show");e.debug_mode&&console.log(r),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_save_action_edition",post_id:o.getParamByName("id"),action_id:d,new_action_data:JSON.stringify(r)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".modal.show").find(".btn-close").click(),t("#joinotify_builder_funnel").children(".funnel-trigger-group").html(i.workflow_content),t(document).trigger("updatedWorkflow"),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},codeEditor:function(){t(".joinotify-code-editor").each((function(){let e=this;if(!t(e).hasClass("initiliazed-editor")){var o=CodeMirror.fromTextArea(e,{mode:"application/x-httpd-php",theme:"dracula",lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,indentUnit:4,tabSize:4,autoRefresh:!0});t(e).addClass("initiliazed-editor"),""===o.getValue().trim()?o.setValue("<?php\n\n"):o.setValue(e.value),o.on("change",(function(){e.value=o.getValue(),t(e).trigger("change")})),setTimeout((()=>{let o=t(e).next(".CodeMirror");if(o.length>0){let i=t('<div class="joinotify-resize-code-area"><svg class="icon-sm icon-dark opacity-75" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path></svg></div>');o.after(i);let a=!1,n=0,s=0;function d(t){if(!a)return;let e=t.clientY-n,i=s+e;i<100&&(i=100),o.css("height",i+"px"),o.find(".CodeMirror-scroll").css("height",i+"px")}function r(){a=!1,t(document).off("mousemove",d),t(document).off("mouseup",r)}i.on("mousedown",(function(e){e.preventDefault(),a=!0,n=e.clientY,s=o.outerHeight(),t(document).on("mousemove",d),t(document).on("mouseup",r)}))}else console.warn("CodeMirror element not found for textarea:",e)}),300)}}))},codePreview:function(){t(".joinotify-code-preview").each((function(){let e=CodeMirror.fromTextArea(this,{mode:"application/x-httpd-php",theme:"dracula",lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,indentUnit:4,tabSize:4,readOnly:"nocursor"});t(this).addClass("initiliazed-preview"),e.setSize("100%","auto"),t(e.getWrapperElement()).addClass("preview")}))},saveTriggerSettings:function(){t(document).on("click",".save-trigger-settings",(function(i){i.preventDefault();var a=t(this),n=o.keepButtonState(a),s=a.data("trigger"),d=a.data("trigger-id"),r={};"woocommerce_order_status_changed"===s?r={order_status:t(".modal.show").find(".set-trigger-settings.order-status").val()}:"wpforms_process_complete"!==s&&"wpforms_paypal_standard_process_complete"!==s||(r={form_id:t(".modal.show").find(".set-trigger-settings.wpforms-form-id").val()}),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_save_trigger_settings",post_id:o.getParamByName("id"),trigger_id:d,settings:JSON.stringify(r)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.debug_mode&&console.log(i);try{"success"===i.status?(t(".modal.show").find(".btn-close").click(),o.displayToast("success",i.toast_header_title,i.toast_body_title)):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},complete:function(){a.prop("disabled",!1).html(n.html)}})}))},emojiPicker:function(){var o=e.emoji_picker_i18n;t(".add-emoji-picker").hasClass("emoji-initialized")||(setTimeout((()=>{t(".add-emoji-picker").emojioneArea({tones:!0,hidePickerOnBlur:!0,recentEmojis:!0,pickerPosition:"bottom",searchPlaceholder:o.placeholder,buttonTitle:o.button_title,filters:{tones:{title:o.filters.tones_title},recent:{title:o.filters.recent_title},smileys_people:{title:o.filters.smileys_people_title},animals_nature:{title:o.filters.animals_nature_title},food_drink:{title:o.filters.food_drink_title},activity:{title:o.filters.activity_title},travel_places:{title:o.filters.travel_places_title},objects:{title:o.filters.objects_title},symbols:{title:o.filters.symbols_title},flags:{title:o.filters.flags_title}}})}),600),t(".add-emoji-picker").addClass("emoji-initialized")),t(document).on("keyup change",".emojionearea-editor",(function(){var e=t(this).html();t(this).closest(".add-emoji-picker").val(e)}))},searchWooProducts:function(){var i=!1;t(document).on("keyup",".search-products",(function(){let a=t(this),n=a.val().trim(),s=t(".search-products-results-wrapper");n.length>=3?(i||(i=!0,a.after('<i class="spinner-border specific-search-spinner"></i>')),t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_get_woo_products",search_query:n},success:function(e){t(".specific-search-spinner").remove(),i=!1,s.html(e.results_html),o.purchasedProducts.forEach((function(t){s.find('.list-group-item.product-item[data-product-id="'+t+'"]').addClass("active")}))},error:function(t,e,o){console.error("Error on search request:",o)}})):s.html("")})),t(document).on("click",".list-group-item.product-item",(function(){let e=t(this).data("product-id");t(this).toggleClass("active"),t(this).hasClass("active")?o.purchasedProducts.includes(e)||o.purchasedProducts.push(e):o.purchasedProducts=o.purchasedProducts.filter((t=>t!==e))}))}};jQuery(document).ready((function(t){o.init()}))}(jQuery);