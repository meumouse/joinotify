!function(e){"use strict";const t=window.joinotify_params||{};var o={activateTabs:function(){e(document).ready((function(){let t=window.location.hash,o=localStorage.getItem("joinotify_get_admin_tab_index");if(t){let o=e('.joinotify-wrapper a.nav-tab[href="'+t+'"]');o.length&&o.click()}else null!==o?e(".joinotify-wrapper a.nav-tab").eq(o).click():e('.joinotify-wrapper a.nav-tab[href="#general"]').click()})),e(document).on("click",".joinotify-wrapper a.nav-tab",(function(){let t=e(this).index();localStorage.setItem("joinotify_get_admin_tab_index",t);let o=e(this).attr("href");return e(".joinotify-wrapper a.nav-tab").removeClass("nav-tab-active"),e(".joinotify-form .nav-content").removeClass("active"),e(this).addClass("nav-tab-active"),e(".joinotify-form").find(o).addClass("active"),!1}))},hideToasts:function(){e(document).on("click",".hide-toast",(function(){var t=e(".toast.show").attr("id");e("#"+t).fadeOut("fast"),setTimeout((function(){e("#"+t).remove()}),500)}))},displayPopup:function(e,t,o){e.on("click",(function(e){e.preventDefault(),t.addClass("show")})),t.on("click",(function(e){e.target===this&&jQuery(this).removeClass("show")})),o.on("click",(function(e){e.preventDefault(),t.removeClass("show")}))},displayToast:function(t,o,n){var i="",s="",a="";"success"===t?(i="toast-success",s="bg-success text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===t?(i="toast-danger",s="bg-danger text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):"warning"===t?(i="toast-warning",s="bg-warning text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(i="toast-secondary",s="bg-secondary text-white",a="");var r="toast-"+Math.random().toString(36).substr(2,9),l=`<div id="${r}" class="toast ${i} show">\n                <div class="toast-header ${s}">\n                    ${a}\n                    <span class="me-auto">${o}</span>\n                    <button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n                <div class="toast-body">${n}</div>\n            </div>`;e(".joinotify-wrapper").prepend(l),setTimeout((function(){jQuery("#"+r).fadeOut("fast")}),3e3),setTimeout((function(){jQuery("#"+r).remove()}),3500)},keepButtonState:function(e){var t=e.width(),o=e.height(),n=e.html();return e.width(t),e.height(o),{width:t,height:o,html:n}},saveOptions:function(){let n=e('form[name="joinotify-options-form"]'),i=n.serialize();e("#joinotify_save_options").on("click",(function(s){s.preventDefault();let a=e(this),r=o.keepButtonState(a);e.ajax({url:t.ajax_url,type:"POST",data:{action:"joinotify_save_options",form_data:n.serialize()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){t.dev_mode&&console.log(e);try{"success"===e.status&&(i=n.serialize(),o.displayToast("success",e.toast_header_title,e.toast_body_title))}catch(e){console.log(e)}},error:function(e,t,o){console.error("AJAX Error:",t,o)},complete:function(){a.html(r.html)}})})),n.on("change input","input, select, textarea",(function(){n.serialize()!==i?e("#joinotify_save_options").prop("disabled",!1):e("#joinotify_save_options").prop("disabled",!0)}))},getPhoneNumbers:function(){function n(){var n=e(".validate-otp-code").data("phone"),i="";e(".otp-input-item").each((function(){i+=e(this).val()})),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_validate_otp",phone:n,otp:i},beforeSend:function(){e(".validate-otp-code").prepend('<div class="validating-otp-loader"><span class="spinner-border"></span></div>')},success:function(n){t.dev_mode&&console.log(n),"success"===n.status?(e("#joinotify_current_phones_senders").html(n.current_phone_senders),e("#joinotify_add_new_phone_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)},error:function(e,t,o){console.error("Error on OTP validation request:",e.responseText)}})}o.displayPopup(e("#joinotify_add_new_phone_trigger"),e("#joinotify_add_new_phone_container"),e("#joinotify_add_new_phone_close")),e(document).on("click","#joinotify_add_new_phone_trigger",(function(){e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_get_phone_numbers"},beforeSend:function(){e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 5rem;"></div>')},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status&&(o.empty_phone_message?e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="alert alert-info">'+o.empty_phone_message+"</div>"):o.phone_numbers_html&&e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(o.phone_numbers_html))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)}})})),e(document).on("click",".register-sender, .request-new-otp",(function(i){i.preventDefault();let s=e(this);var a=o.keepButtonState(s);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_register_phone_sender",phone:s.data("phone")},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){t.dev_mode&&console.log(i);try{"success"===i.status?(e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(i.otp_input_component),function(){var o=e(".countdown-otp-resend"),n=e(".validate-otp-code").data("phone"),i=60;o.text(i);var s=setInterval((function(){i--,o.text(i),i<=0&&(clearInterval(s),e("#joinotify_add_new_phone_container").find(".resend-otp").html('<button class="btn btn-sm btn-outline-primary request-new-otp" data-phone="'+n+'">'+t.i18n.resend_otp_button+"</button>"))}),1e3)}(),e(".otp-input-item").on("input",(function(){var t=e(this);1===t.val().length&&t.next(".otp-input-item").focus(),0===e(".otp-input-item").filter((function(){return""===e(this).val()})).length&&n()})),e(".otp-input-item").on("paste",(function(t){var o=t.originalEvent.clipboardData.getData("text");4===o.length&&e.isNumeric(o)&&(e(".otp-input-item").each((function(t){e(this).val(o[t])})),n())}))):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){s.prop("disabled",!1).html(a.html)}})}))},removePhoneSender:function(){e(document).on("click",".remove-phone-sender",(function(n){if(n.preventDefault(),!confirm(t.i18n.confirm_remove_sender))return;let i=e(this);var s=i.width(),a=i.height(),r=(i.html(),i.data("phone"));i.width(s),i.height(a),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_remove_phone_sender",phone:r},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){t.dev_mode&&console.log(n);try{"success"===n.status?(e("#joinotify_current_phones_senders").find(".joinotify-phone-list").html(n.updated_list_html),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(btn_state.html)}})}))},resetSettings:function(){o.displayPopup(e("#joinotify_reset_settings_trigger"),e("#joinotify_reset_settings_container"),e("#joinotify_reset_settings_close")),e(document).on("click","#confirm_reset_settings",(function(n){n.preventDefault();let i=e(this),s=o.keepButtonState(i);e.ajax({url:t.ajax_url,type:"POST",data:{action:"joinotify_reset_plugin_action"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){try{"success"===t.status?(e("#joinotify_reset_settings_container").removeClass("show"),o.displayToast("success",t.toast_header_title,t.toast_body_title)):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})}))},sendMessageTest:function(){o.displayPopup(e("#joinotify_send_message_test_trigger"),e("#joinotify_send_message_test_container"),e("#joinotify_send_message_test_close"));var n=e("#joinotify_get_phone_receive_test"),i=e("#joinotify_get_test_message");e(document).on("change input keyup",e(n,i),(function(){""!==e(n).val()&&""!==e(i).val()?e("#joinotify_send_test_message").prop("disabled",!1):e("#joinotify_send_test_message").prop("disabled",!0)})),e(document).on("click","#joinotify_send_test_message",(function(s){s.preventDefault();let a=e(this),r=o.keepButtonState(a);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_send_message_test",sender:e("#joinotify_select_sender_test").val(),receiver:e(n).val(),message:e(i).val()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){t.dev_mode&&console.log(n);try{"success"===n.status?(e(i).val("").change(),e("#joinotify_send_message_test_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){a.prop("disabled",!1).html(r.html)}})}))},containerVisibility:function(t,o){let n=e(t).prop("checked");e(o).toggleClass("d-none",!n)},visibilityController:function(t,n){o.containerVisibility(t,n),e(t).click((function(){o.containerVisibility(t,n)}))},generateRandomKey:function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let n=0;n<e;n++)o+=t.charAt(Math.floor(62*Math.random()));return o},proxyApiSettings:function(){o.visibilityController(e("#enable_proxy_api"),e(".require-proxy-api")),o.displayPopup(e("#proxy_api_settings_trigger"),e("#proxy_api_settings_container"),e("#proxy_api_settings_close")),e("#joinotify_generate_proxy_api_key").on("click",(function(t){t.preventDefault();const n=o.generateRandomKey(32);e("#proxy_api_key").val(n).change()}))},handleDebugLogs:function(){o.visibilityController(e("#enable_debug_mode"),e(".require-debug-mode")),o.displayPopup(e("#joinotify_get_debug_details_trigger"),e("#joinotify_get_debug_details_container"),e("#joinotify_get_debug_details_close")),e("#joinotify_get_debug_details_trigger").on("click",(function(n){n.preventDefault(),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_get_debug_logs"},success:function(n){t.dev_mode&&console.log(n);try{"success"===n.status?(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(n.log_content),e("#joinotify_clear_log_file").prop("disabled",!1),e("#joinotify_download_log_file").prop("disabled",!1)):(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(`<div class="alert alert-info">${n.toast_body_title}</div>`),o.displayToast("warning",n.toast_header_title,n.toast_body_title))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)}})})),e("#joinotify_get_debug_details_container").on("click",(function(t){t.target===this&&(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),e("#joinotify_clear_log_file").prop("disabled",!0),e("#joinotify_download_log_file").prop("disabled",!0))})),e("#joinotify_clear_log_file").on("click",(function(n){if(n.preventDefault(),!confirm(t.i18n.confirm_clear_debug_logs))return;let i=e(this),s=o.keepButtonState(i);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_clear_debug_logs"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){t.dev_mode&&console.log(n);try{"success"===n.status?(e("#joinotify_get_debug_details_container").removeClass("show").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})})),e("#joinotify_download_log_file").on("click",(function(n){n.preventDefault();let i=e(this),s=o.keepButtonState(i);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_download_debug_logs"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){t.dev_mode&&console.log(n);try{if("success"===n.status){e("#joinotify_get_debug_details_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title);const t=n.download_url,i=document.createElement("a");i.href=t,i.download="joinotify-debug-logs.txt",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})}))},displayWooCommerceSettings:function(){o.visibilityController(e("#enable_woocommerce_integration"),e("#woocommerce_settings_trigger")),o.displayPopup(e("#woocommerce_settings_trigger"),e("#woocommerce_settings_container"),e("#woocommerce_settings_close")),o.visibilityController(e("#enable_create_coupon_action"),e(".create-coupon-wrapper"))},checkConnection:function(){e(document).on("click",".check-instance-connection",(function(n){n.preventDefault();let i=e(this),s=i.data("phone");e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_check_instance_connection",phone:s},beforeSend:function(){i.prop("disabled",!0).addClass("animate-loader")},success:function(n){t.dev_mode&&console.log(n);try{n.display_state_component&&e(`.list-group-item[data-phone="${s}"]`).find(".phone-status").replaceWith(n.display_state_component),"success"===n.status?(i.prop("disabled",!1).removeClass("animate-loader"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){i.prop("disabled",!1).removeClass("animate-loader"),console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).removeClass("animate-loader")}})}))},detectOfflineConnection:function(){function e(){navigator.onLine||o.displayToast("warning",t.i18n.offline_toast_header,t.i18n.offline_toast_body)}e(),window.addEventListener("online",e),window.addEventListener("offline",e)},init:function(){this.activateTabs(),this.hideToasts(),this.saveOptions(),this.getPhoneNumbers(),this.removePhoneSender(),this.resetSettings(),this.sendMessageTest(),this.proxyApiSettings(),this.handleDebugLogs(),this.displayWooCommerceSettings(),this.checkConnection(),this.detectOfflineConnection()}};jQuery(document).ready((function(e){o.init()}))}(jQuery);