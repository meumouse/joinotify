!function(t){"use strict";const e=window.joinotify_params||{};var o={activateTabs:function(){t(document).ready((function(){let e=window.location.hash,o=localStorage.getItem("joinotify_get_admin_tab_index");if(e){let o=t('.joinotify-wrapper a.nav-tab[href="'+e+'"]');o.length&&o.click()}else null!==o?t(".joinotify-wrapper a.nav-tab").eq(o).click():t('.joinotify-wrapper a.nav-tab[href="#general"]').click()})),t(document).on("click",".joinotify-wrapper a.nav-tab",(function(){let e=t(this).index();localStorage.setItem("joinotify_get_admin_tab_index",e);let o=t(this).attr("href");return t(".joinotify-wrapper a.nav-tab").removeClass("nav-tab-active"),t(".joinotify-form .nav-content").removeClass("active"),t(this).addClass("nav-tab-active"),t(".joinotify-form").find(o).addClass("active"),!1}))},hideToasts:function(){t(document).on("click",".hide-toast",(function(){var e=t(".toast.show").attr("id");t("#"+e).fadeOut("fast"),setTimeout((function(){t("#"+e).remove()}),500)}))},displayPopup:function(t,e,o){t.on("click",(function(t){t.preventDefault(),e.addClass("show")})),e.on("click",(function(t){t.target===this&&jQuery(this).removeClass("show")})),o.on("click",(function(t){t.preventDefault(),e.removeClass("show")}))},displayToast:function(e,o,n){var i="",s="",a="";"success"===e?(i="toast-success",s="bg-success text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===e?(i="toast-danger",s="bg-danger text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):"warning"===e?(i="toast-warning",s="bg-warning text-white",a='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(i="toast-secondary",s="bg-secondary text-white",a="");var r="toast-"+Math.random().toString(36).substr(2,9),l=`<div id="${r}" class="toast ${i} show">\n                <div class="toast-header ${s}">\n                    ${a}\n                    <span class="me-auto">${o}</span>\n                    <button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n                <div class="toast-body">${n}</div>\n            </div>`;t(".joinotify-wrapper").prepend(l),setTimeout((function(){jQuery("#"+r).fadeOut("fast")}),3e3),setTimeout((function(){jQuery("#"+r).remove()}),3500)},keepButtonState:function(t){var e=t.width(),o=t.height(),n=t.html();return t.width(e),t.height(o),{width:e,height:o,html:n}},saveOptions:function(){let n=t('form[name="joinotify-options-form"]'),i=n.serialize();t("#joinotify_save_options").on("click",(function(s){s.preventDefault();let a=t(this),r=o.keepButtonState(a);t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_save_options",form_data:n.serialize()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){e.dev_mode&&console.log(t);try{"success"===t.status&&(i=n.serialize(),o.displayToast("success",t.toast_header_title,t.toast_body_title))}catch(t){console.log(t)}},error:function(t,e,o){console.error("AJAX Error:",e,o)},complete:function(){a.html(r.html)}})})),n.on("change input","input, select, textarea",(function(){n.serialize()!==i?t("#joinotify_save_options").prop("disabled",!1):t("#joinotify_save_options").prop("disabled",!0)}))},getPhoneNumbers:function(){function n(){var n=t(".validate-otp-code").data("phone"),i="";t(".otp-input-item").each((function(){i+=t(this).val()})),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_validate_otp",phone:n,otp:i},beforeSend:function(){t(".validate-otp-code").prepend('<div class="validating-otp-loader"><span class="spinner-border"></span></div>')},success:function(n){e.dev_mode&&console.log(n),"success"===n.status?(t("#joinotify_current_phones_senders").html(n.current_phone_senders),t("#joinotify_add_new_phone_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)},error:function(t,e,o){console.error("Error on OTP validation request:",t.responseText)}})}o.displayPopup(t("#joinotify_add_new_phone_trigger"),t("#joinotify_add_new_phone_container"),t("#joinotify_add_new_phone_close")),t(document).on("click","#joinotify_add_new_phone_trigger",(function(){t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_phone_numbers"},beforeSend:function(){t("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 5rem;"></div>')},success:function(o){e.debug_mode&&console.log(o);try{"success"===o.status&&(o.empty_phone_message?t("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="alert alert-info">'+o.empty_phone_message+"</div>"):o.phone_numbers_html&&t("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(o.phone_numbers_html))}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)}})})),t(document).on("click",".register-sender, .request-new-otp",(function(i){i.preventDefault();let s=t(this);var a=o.keepButtonState(s);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_register_phone_sender",phone:get_phone},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(i){e.dev_mode&&console.log(i);try{"success"===i.status?(t("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(i.otp_input_component),function(){var o=t(".countdown-otp-resend"),n=t(".validate-otp-code").data("phone"),i=60;o.text(i);var s=setInterval((function(){i--,o.text(i),i<=0&&(clearInterval(s),t("#joinotify_add_new_phone_container").find(".resend-otp").html('<button class="btn btn-sm btn-outline-primary request-new-otp" data-phone="'+n+'">'+e.i18n.resend_otp_button+"</button>"))}),1e3)}(),t(".otp-input-item").on("input",(function(){var e=t(this);1===e.val().length&&e.next(".otp-input-item").focus(),0===t(".otp-input-item").filter((function(){return""===t(this).val()})).length&&n()})),t(".otp-input-item").on("paste",(function(e){var o=e.originalEvent.clipboardData.getData("text");4===o.length&&t.isNumeric(o)&&(t(".otp-input-item").each((function(e){t(this).val(o[e])})),n())}))):o.displayToast("error",i.toast_header_title,i.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){s.prop("disabled",!1).html(a.html)}})}))},removePhoneSender:function(){t(document).on("click",".remove-phone-sender",(function(n){if(n.preventDefault(),!confirm(e.i18n.confirm_remove_sender))return;let i=t(this);var s=i.width(),a=i.height(),r=(i.html(),i.data("phone"));i.width(s),i.height(a),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_remove_phone_sender",phone:r},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){e.dev_mode&&console.log(n);try{"success"===n.status?(t("#joinotify_current_phones_senders").find(".joinotify-phone-list").html(n.updated_list_html),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){i.prop("disabled",!1).html(btn_state.html)}})}))},resetSettings:function(){o.displayPopup(t("#joinotify_reset_settings_trigger"),t("#joinotify_reset_settings_container"),t("#joinotify_reset_settings_close")),t(document).on("click","#confirm_reset_settings",(function(n){n.preventDefault();let i=t(this),s=o.keepButtonState(i);t.ajax({url:e.ajax_url,type:"POST",data:{action:"joinotify_reset_plugin_action"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){try{"success"===e.status?(t("#joinotify_reset_settings_container").removeClass("show"),o.displayToast("success",e.toast_header_title,e.toast_body_title)):o.displayToast("error",e.toast_header_title,e.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})}))},sendMessageTest:function(){o.displayPopup(t("#joinotify_send_message_test_trigger"),t("#joinotify_send_message_test_container"),t("#joinotify_send_message_test_close"));var n=t("#joinotify_get_phone_receive_test"),i=t("#joinotify_get_test_message");t(document).on("change input keyup",t(n,i),(function(){""!==t(n).val()&&""!==t(i).val()?t("#joinotify_send_test_message").prop("disabled",!1):t("#joinotify_send_test_message").prop("disabled",!0)})),t(document).on("click","#joinotify_send_test_message",(function(s){s.preventDefault();let a=t(this),r=o.keepButtonState(a);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_send_message_test",sender:t("#joinotify_select_sender_test").val(),receiver:t(n).val(),message:t(i).val()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){e.dev_mode&&console.log(n);try{"success"===n.status?(t(i).val("").change(),t("#joinotify_send_message_test_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){a.prop("disabled",!1).html(r.html)}})}))},containerVisibility:function(e,o){let n=t(e).prop("checked");t(o).toggleClass("d-none",!n)},visibilityController:function(e,n){o.containerVisibility(e,n),t(e).click((function(){o.containerVisibility(e,n)}))},generateRandomKey:function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let n=0;n<t;n++)o+=e.charAt(Math.floor(62*Math.random()));return o},proxyApiSettings:function(){o.visibilityController(t("#enable_proxy_api"),t(".require-proxy-api")),o.displayPopup(t("#proxy_api_settings_trigger"),t("#proxy_api_settings_container"),t("#proxy_api_settings_close")),t("#joinotify_generate_proxy_api_key").on("click",(function(e){e.preventDefault();const n=o.generateRandomKey(32);t("#proxy_api_key").val(n).change()}))},handleDebugLogs:function(){o.visibilityController(t("#enable_debug_mode"),t(".require-debug-mode")),o.displayPopup(t("#joinotify_get_debug_details_trigger"),t("#joinotify_get_debug_details_container"),t("#joinotify_get_debug_details_close")),t("#joinotify_get_debug_details_trigger").on("click",(function(n){n.preventDefault(),t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_get_debug_logs"},success:function(n){e.dev_mode&&console.log(n);try{"success"===n.status?(t("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(n.log_content),t("#joinotify_clear_log_file").prop("disabled",!1),t("#joinotify_download_log_file").prop("disabled",!1)):(t("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(`<div class="alert alert-info">${n.toast_body_title}</div>`),o.displayToast("warning",n.toast_header_title,n.toast_body_title))}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)}})})),t("#joinotify_get_debug_details_container").on("click",(function(e){e.target===this&&(t("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),t("#joinotify_clear_log_file").prop("disabled",!0),t("#joinotify_download_log_file").prop("disabled",!0))})),t("#joinotify_clear_log_file").on("click",(function(n){if(n.preventDefault(),!confirm(e.i18n.confirm_clear_debug_logs))return;let i=t(this),s=o.keepButtonState(i);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_clear_debug_logs"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){e.dev_mode&&console.log(n);try{"success"===n.status?(t("#joinotify_get_debug_details_container").removeClass("show").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),o.displayToast("success",n.toast_header_title,n.toast_body_title)):o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})})),t("#joinotify_download_log_file").on("click",(function(n){n.preventDefault();let i=t(this),s=o.keepButtonState(i);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_download_debug_logs"},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){e.dev_mode&&console.log(n);try{if("success"===n.status){t("#joinotify_get_debug_details_container").removeClass("show"),o.displayToast("success",n.toast_header_title,n.toast_body_title);const e=n.download_url,i=document.createElement("a");i.href=e,i.download="joinotify-debug-logs.txt",document.body.appendChild(i),i.click(),document.body.removeChild(i)}else o.displayToast("error",n.toast_header_title,n.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){i.prop("disabled",!1).html(s.html)}})}))},displayWooCommerceSettings:function(){o.visibilityController(t("#enable_woocommerce_integration"),t("#woocommerce_settings_trigger")),o.displayPopup(t("#woocommerce_settings_trigger"),t("#woocommerce_settings_container"),t("#woocommerce_settings_close")),o.visibilityController(t("#enable_create_coupon_action"),t(".create-coupon-wrapper"))},checkConnection:function(){t(document).on("click",".check-instance-connection",(function(n){n.preventDefault();let i=t(this),s=o.keepButtonState(i);t.ajax({url:e.ajax_url,method:"POST",data:{action:"joinotify_check_instance_connection",phone:i.data("phone")},beforeSend:function(){i.addClass("animate-loader")},success:function(t){e.dev_mode&&console.log(t);try{t.display_state_component&&i.siblings(".phone-status").replaceWith(t.display_state_component),"success"===t.status?(i.removeClass("animate-loader"),o.displayToast("success",t.toast_header_title,t.toast_body_title)):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(t){console.log(t)}},error:function(t,e,o){console.error("Error on AJAX request:",t.responseText)},complete:function(){i.prop("disabled",!1).html(s.html),i.removeClass("animate-loader")}})}))},detectOfflineConnection:function(){function t(){navigator.onLine||o.displayToast("warning",e.i18n.offline_toast_header,e.i18n.offline_toast_body)}t(),window.addEventListener("online",t),window.addEventListener("offline",t)},init:function(){this.activateTabs(),this.hideToasts(),this.saveOptions(),this.getPhoneNumbers(),this.removePhoneSender(),this.resetSettings(),this.sendMessageTest(),this.proxyApiSettings(),this.handleDebugLogs(),this.displayWooCommerceSettings(),this.checkConnection(),this.detectOfflineConnection()}};jQuery(document).ready((function(t){o.init()}))}(jQuery);