!function(e){"use strict";const t=joinotify_params,o={init:function(){this.activateTabs(),this.hideToasts(),this.saveOptions(),this.getPhoneNumbers(),this.removePhoneSender(),this.resetSettings(),this.sendMessageTest(),this.proxyApiSettings(),this.handleDebugLogs(),this.displayWooCommerceSettings()},activateTabs:function(){e(document).ready((function(){let t=window.location.hash,o=localStorage.getItem("joinotify_get_admin_tab_index");if(t){let o=e('.joinotify-wrapper a.nav-tab[href="'+t+'"]');o.length&&o.click()}else null!==o?e(".joinotify-wrapper a.nav-tab").eq(o).click():e('.joinotify-wrapper a.nav-tab[href="#general"]').click()})),e(document).on("click",".joinotify-wrapper a.nav-tab",(function(){let t=e(this).index();localStorage.setItem("joinotify_get_admin_tab_index",t);let o=e(this).attr("href");return e(".joinotify-wrapper a.nav-tab").removeClass("nav-tab-active"),e(".joinotify-form .nav-content").removeClass("active"),e(this).addClass("nav-tab-active"),e(".joinotify-form").find(o).addClass("active"),!1}))},hideToasts:function(){e(document).on("click",".hide-toast",(function(){var t=e(".toast.show").attr("id");e("#"+t).fadeOut("fast"),setTimeout((function(){e("#"+t).remove()}),500)}))},saveOptions:function(){let o=e('form[name="joinotify-options-form"]'),n=o.serialize();var i;e("#joinotify_save_options").on("click",(function(s){s.preventDefault();let a=e(this),r=a.html(),l=a.width(),d=a.height();a.width(l),a.height(d),e.ajax({url:t.ajax_url,type:"POST",data:{action:"joinotify_save_options",form_data:o.serialize()},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(s){t.debug_mode&&console.log(s);try{"success"===s.status&&(n=o.serialize(),display_toast("success",s.toast_header_title,s.toast_body_title,e(".joinotify-wrapper")),i&&clearTimeout(i),i=setTimeout((function(){e(".toast-save-options").fadeOut("fast",(function(){e(".toast-save-options").remove()}))}),3e3))}catch(e){console.log(e)}},error:function(e,t,o){console.error("AJAX Error:",t,o)},complete:function(){a.html(r)}})})),o.on("change input","input, select, textarea",(function(){o.serialize()!==n?e("#joinotify_save_options").prop("disabled",!1):e("#joinotify_save_options").prop("disabled",!0)}))},getPhoneNumbers:function(){function o(){var o=e(".validate-otp-code").data("phone"),n="";e(".otp-input-item").each((function(){n+=e(this).val()})),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_validate_otp",phone:o,otp:n},beforeSend:function(){e(".validate-otp-code").prepend('<div class="validating-otp-loader"><span class="spinner-border"></span></div>')},success:function(o){t.debug_mode&&console.log(o),"success"===o.status?(e("#joinotify_current_phones_senders").html(o.current_phone_senders),e("#joinotify_add_new_phone_container").removeClass("show"),display_toast("success",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))):display_toast("error",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))},error:function(e,t,o){console.error("Error on OTP validation request:",e.responseText)}})}display_popup(e("#joinotify_add_new_phone_trigger"),e("#joinotify_add_new_phone_container"),e("#joinotify_add_new_phone_close")),e(document).on("click","#joinotify_add_new_phone_trigger",(function(){e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_get_phone_numbers"},beforeSend:function(){e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 5rem;"></div>')},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status&&(o.empty_phone_message?e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html('<div class="alert alert-info">'+o.empty_phone_message+"</div>"):o.phone_numbers_html&&e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(o.phone_numbers_html))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)}})})),e(document).on("click",".register-sender, .request-new-otp",(function(n){n.preventDefault();var i=e(this),s=i.width(),a=i.height(),r=i.html(),l=i.data("phone");i.width(s),i.height(a),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_register_phone_sender",phone:l},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(n){t.debug_mode&&console.log(n);try{"success"===n.status?(e("#joinotify_add_new_phone_container").find(".joinotify-popup-body").html(n.otp_input_component),function(){var o=e(".countdown-otp-resend"),n=e(".validate-otp-code").data("phone"),i=60;o.text(i);var s=setInterval((function(){i--,o.text(i),i<=0&&(clearInterval(s),e("#joinotify_add_new_phone_container").find(".resend-otp").html('<button class="btn btn-sm btn-outline-primary request-new-otp" data-phone="'+n+'">'+t.resend_otp_button+"</button>"))}),1e3)}(),e(".otp-input-item").on("input",(function(){var t=e(this);1===t.val().length&&t.next(".otp-input-item").focus(),0===e(".otp-input-item").filter((function(){return""===e(this).val()})).length&&o()})),e(".otp-input-item").on("paste",(function(t){var n=t.originalEvent.clipboardData.getData("text");4===n.length&&e.isNumeric(n)&&(e(".otp-input-item").each((function(t){e(this).val(n[t])})),o())}))):display_toast("error",n.toast_header_title,n.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(r)}})}))},removePhoneSender:function(){e(document).on("click",".remove-phone-sender",(function(o){if(o.preventDefault(),confirm(t.confirm_remove_sender)){var n=e(this),i=n.width(),s=n.height(),a=n.html(),r=n.data("phone");n.width(i),n.height(s),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_remove_phone_sender",phone:r},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status?(e("#joinotify_current_phones_senders").find(".joinotify-phone-list").html(o.updated_list_html),display_toast("success",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))):display_toast("error",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){n.prop("disabled",!1).html(a)}})}}))},resetSettings:function(){display_popup(e("#joinotify_reset_settings_trigger"),e("#joinotify_reset_settings_container"),e("#joinotify_reset_settings_close")),e(document).on("click","#confirm_reset_settings",(function(o){o.preventDefault();let n=e(this),i=n.html(),s=n.width(),a=n.height();n.width(s),n.height(a),e.ajax({url:t.ajax_url,type:"POST",data:{action:"joinotify_reset_plugin_action"},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){try{"success"===t.status?(e("#joinotify_reset_settings_container").removeClass("show"),display_toast("success",t.toast_header_title,t.toast_body_title,e(".joinotify-wrapper"))):display_toast("error",t.toast_header_title,t.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){n.prop("disabled",!1).html(i)}})}))},sendMessageTest:function(){display_popup(e("#joinotify_send_message_test_trigger"),e("#joinotify_send_message_test_container"),e("#joinotify_send_message_test_close"));var o=e("#joinotify_get_phone_receive_test"),n=e("#joinotify_get_test_message");e(document).on("change input keyup",e(o,n),(function(){""!==e(o).val()&&""!==e(n).val()?e("#joinotify_send_test_message").prop("disabled",!1):e("#joinotify_send_test_message").prop("disabled",!0)})),e(document).on("click","#joinotify_send_test_message",(function(i){i.preventDefault();let s=e(this),a=s.html(),r=s.width(),l=s.height();s.width(r),s.height(l),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_send_message_test",sender:e("#joinotify_select_sender_test").val(),receiver:e(o).val(),message:e(n).val()},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status?(e(n).val("").change(),e("#joinotify_send_message_test_container").removeClass("show"),display_toast("success",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))):display_toast("error",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){s.prop("disabled",!1).html(a)}})}))},proxyApiSettings:function(){visibility_controller(e("#enable_proxy_api"),e(".require-proxy-api")),display_popup(e("#proxy_api_settings_trigger"),e("#proxy_api_settings_container"),e("#proxy_api_settings_close")),e("#joinotify_generate_proxy_api_key").on("click",(function(t){t.preventDefault();const o=function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let n=0;n<e;n++)o+=t.charAt(Math.floor(62*Math.random()));return o}(32);e("#proxy_api_key").val(o).change()}))},handleDebugLogs:function(){visibility_controller(e("#enable_debug_mode"),e(".require-debug-mode")),display_popup(e("#joinotify_get_debug_details_trigger"),e("#joinotify_get_debug_details_container"),e("#joinotify_get_debug_details_close")),e("#joinotify_get_debug_details_trigger").on("click",(function(o){o.preventDefault(),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_get_debug_logs"},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status?(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(o.log_content),e("#joinotify_clear_log_file").prop("disabled",!1),e("#joinotify_download_log_file").prop("disabled",!1)):(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html(`<div class="alert alert-info">${o.toast_body_title}</div>`),display_toast("warning",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper")))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)}})})),e("#joinotify_get_debug_details_container").on("click",(function(t){t.target===this&&(e("#joinotify_get_debug_details_container").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),e("#joinotify_clear_log_file").prop("disabled",!0),e("#joinotify_download_log_file").prop("disabled",!0))})),e("#joinotify_clear_log_file").on("click",(function(o){if(o.preventDefault(),confirm(t.confirm_clear_debug_logs)){var n=e(this),i=n.width(),s=n.height(),a=n.html();n.width(i),n.height(s),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_clear_debug_logs"},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(o){t.debug_mode&&console.log(o);try{"success"===o.status?(e("#joinotify_get_debug_details_container").removeClass("show").find(".joinotify-popup-body").html('<div class="placeholder-content" style="width: 100%; height: 10rem;"></div>'),display_toast("success",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))):display_toast("error",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){n.prop("disabled",!1).html(a)}})}})),e("#joinotify_download_log_file").on("click",(function(o){o.preventDefault();var n=e(this),i=n.width(),s=n.height(),a=n.html();n.width(i),n.height(s),e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_download_debug_logs"},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(o){t.debug_mode&&console.log(o);try{if("success"===o.status){e("#joinotify_get_debug_details_container").removeClass("show"),display_toast("success",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"));const t=o.download_url,n=document.createElement("a");n.href=t,n.download="joinotify-debug-logs.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else display_toast("error",o.toast_header_title,o.toast_body_title,e(".joinotify-wrapper"))}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){n.prop("disabled",!1).html(a)}})}))},displayWooCommerceSettings:function(){display_popup(e("#woocommerce_settings_trigger"),e("#woocommerce_settings_container"),e("#woocommerce_settings_container"))}};jQuery(document).ready((function(e){o.init()}))}(jQuery);