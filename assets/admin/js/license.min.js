!function(e){"use strict";var t=window.joinotify_license_params||{};const s={displayToast:function(s,o,n){let a="",i="",l="";"success"===s?(a="toast-success",i="bg-success text-white",l='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===s?(a="toast-danger",i="bg-danger text-white",l='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(a="toast-secondary",i="bg-secondary text-white",l="");const c="toast-"+Math.random().toString(36).substr(2,9),r=`<div id="${c}" class="toast ${a} show">\n\t\t\t\t<div class="toast-header ${i}">\n\t\t\t\t\t${l}\n\t\t\t\t\t<span class="me-auto">${o}</span>\n\t\t\t\t\t<button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="${t.i18n.close_notice_aria_label}"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="toast-body">${n}</div>\n\t\t\t</div>`;e("#joinotify_license_area").prepend(r),setTimeout((function(){e("#"+c).fadeOut("fast")}),3e3),setTimeout((function(){e("#"+c).remove()}),3500)},keepButtonState:function(e){var t=e.width(),s=e.height(),o=e.html();return e.width(t),e.height(s),{width:t,height:s,html:o}},activateLicense:function(){e("#joinotify_active_license").on("click",(function(o){o.preventDefault();let n=e(this),a=s.keepButtonState(n);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_active_license",license_key:e("#joinotify_license_key").val()},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){try{"success"===e.status?(s.displayToast("success",e.toast_header_title,e.toast_body_title),setTimeout((function(){location.reload()}),1e3)):s.displayToast("error",e.toast_header_title,e.toast_body_title)}catch(e){console.log(e)}},complete:function(){n.prop("disabled",!1).html(a.html)},error:function(e,t,s){alert("AJAX error: "+s)}})}))},deactivateLicense:function(){e("#joinotify_deactive_license").on("click",(function(o){if(o.preventDefault(),!confirm(t.i18n.confirm_deactivate_license))return;let n=e(this),a=s.keepButtonState(n);e.ajax({url:t.ajax_url,method:"POST",data:{action:"joinotify_deactive_license"},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){try{"success"===e.status?(s.displayToast("success",e.toast_header_title,e.toast_body_title),setTimeout((function(){location.reload()}),1e3)):s.displayToast("error",e.toast_header_title,e.toast_body_title)}catch(e){console.log(e)}},complete:function(){n.prop("disabled",!1).html(a.html)},error:function(e,t,s){alert("AJAX error: "+s)}})}))},alternativeActivation:function(){e("#license_key_zone").on("dragover dragleave",(function(t){t.preventDefault(),e(this).toggleClass("drag-over","dragover"===t.type)})),e("#license_key_zone").on("drop",(function(t){t.preventDefault();const o=t.originalEvent.dataTransfer.files[0];e(this).hasClass("file-uploaded")||s.handleFile(o,e(this))})),e("#upload_license_key").on("change",(function(t){const o=t.target.files[0];s.handleFile(o,e(this).parents(".dropzone-license"))}))},handleFile:function(o,n){if(o){const a=o.name,i=new FormData;i.append("action","joinotify_alternative_activation_license"),i.append("file",o),n.children(".file-list").removeClass("d-none").text(a),n.addClass("file-processing"),n.append('<div class="spinner-border"></div>'),e.ajax({url:t.ajax_url,type:"POST",data:i,processData:!1,contentType:!1,success:function(e){t.debug_mode&&console.log(e);try{"success"===e.status?(s.displayToast("success",e.toast_header_title,e.toast_body_title),n.addClass("file-uploaded").removeClass("file-processing"),n.children(".spinner-border").remove(),n.append('<div class="upload-notice d-flex flex-column align-items-center"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="#22c55e" d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path fill="#22c55e" d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg><span>'+e.dropfile_message+"</span></div>"),n.children(".file-list").addClass("d-none"),setTimeout((function(){location.reload()}),1e3)):(s.displayToast("error",e.toast_header_title,e.toast_body_title),n.addClass("invalid-file").removeClass("drag-over file-processing"),n.children(".spinner-border").remove(),n.children(".drag-text").removeClass("d-none"),n.children(".drag-and-drop-file").removeClass("d-none"),n.children(".upload-license-key").removeClass("d-none"),n.children(".file-list").addClass("d-none"))}catch(e){console.log(e)}},error:function(e,t,s){n.addClass("fail-upload").removeClass("file-processing"),console.log("Error on upload file"),console.log(e.responseText)}})}},init:function(){this.activateLicense(),this.deactivateLicense(),this.alternativeActivation()}};e(document).ready((function(){s.init()}))}(jQuery);